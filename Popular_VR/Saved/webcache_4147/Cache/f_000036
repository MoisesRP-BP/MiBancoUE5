(function(){function Oa(a){a.addEventListener(m.connection.Events.FATAL_ERROR,function(a){return l.connection.onError(a.message)},"legacy-connection-fatal-error");a.addEventListener(m.connection.Events.MESSAGE_RECEIVED,function(a){return l.connection.messageHandler(a.type.toString(),a.body)},"legacy-connection-message-received");a.addEventListener(m.connection.Events.RECONNECTING,function(){return l.connection.onReconnect(!1)},"legacy-connection-reconnecting");a.addEventListener(m.connection.Events.RECONNECTED,
function(){return l.connection.onReconnect(!0)},"legacy-connection-reconnected");a.addEventListener(m.connection.Events.REINIT,function(){return l.connection.onReInit()},"legacy-connection-reinit");a.addEventListener(m.connection.Events.LONG_POLL_COMPLETED,function(){return l.connection.onLongPoll()},"legacy-connection-longpoll-completed")}function qa(){var a=[],b=[],d=null,c=null;return{complete:function(b){if(null!=d)return d&&window.setTimeout(function(){b.call(window,c)},1),this;a.push(b);return this},
error:function(a){if(null!=d)return d||window.setTimeout(function(){a.call(window,c)},1),this;b.push(a);return this},callback:function(e,f){d=e;c=f;(e?a:b).forEach(function(a){(a=a.call(window,f))&&(f=a)});return this}}}function ra(){this.getPublicInterface=function(){var a;this.lockedPublicInterface||(a=this.createPublicInterface(),this.lockedPublicInterface=G.finalizeObject(a));return this.lockedPublicInterface?this.lockedPublicInterface:a}}function Xa(a){var b={};a.addEventListener=function(a,
c,e){"undefined"==typeof e&&(e="");b[a]||(b[a]=[]);b[a].push({listenerId:e,handler:c})};a.dispatchEvent=function(a,c){b[a]&&b[a].forEach(function(a){try{a.handler.call(window,c)}catch(b){G.error(b)}})};a.removeEventListeners=function(a){if("undefined"==typeof a)b={};else for(var c in b)if(b.hasOwnProperty(c))for(var e=b[c].length;e--;)b[c][e].listenerId==a&&b[c].splice(e,1)}}function Ya(a){switch(a){case "'":return"\x26#39;";case "\x26":return"\x26amp;";case "\x3c":return"\x26lt;";case "\x3e":return"\x26gt;";
case '"':return"\x26quot;";case "\u00a9":return"\x26copy;";case "\u2028":return"\x3cbr\x3e";case "\u2029":return"\x3cp\x3e";default:return a}}function v(a,b,d,c,e,f){e||(f=new Date,e=f.toLocaleString());f||(f=Date.now());this.createPublicInterface=function(){return{getType:function(){return a},getContent:function(){return b},getName:function(){return d},getUserId:function(){return c},getTimestamp:function(){return e},getDate:function(){return f}}}}function Pa(a,b,d){var c=[],e=[],f=!1;this.addEntityMap=
function(a,b,d,e,u){for(var n=0;n<c.length;n++){var f=c[n];if(f.entityName==a&&f.fieldName==b){d&&(f.isFastFillable=!0);e&&(f.isAutoQueryable=!0);u&&(f.isExactMatchable=!0);return}}c.push({entityName:a,fieldName:b,isFastFillable:d,isAutoQueryable:e,isExactMatchable:u})};this.addTranscriptField=function(a){e.push(a)};this.doKnowledgeSearch=function(){f=!0};this.createPublicInterface=function(){return{getLabel:function(){return a},getValue:function(){return b},getEntityMaps:function(){return c},getTranscriptFields:function(){return e},
getDisplayToAgent:function(){return d},getDoKnowledgeSearch:function(){return f}}}}function Qa(a,b,d,c,e){var f=[];this.addEntityFieldsMaps=function(b,c,d,e,u){for(var n=0;n<f.length;n++){var N=f[n];if(N.entityName==a&&N.fieldName==b){d&&(N.doFind=!0);e&&(N.isExactMatch=!0);return}}f.push({fieldName:b,label:c,doFind:d,isExactMatch:e,doCreate:u})};this.createPublicInterface=function(){return{getEntityName:function(){return a},getShowOnCreate:function(){return b},getLinkToEntityName:function(){return d},
getLinkToEntityField:function(){return c},getSaveToTranscript:function(){return e},getEntityFieldsMaps:function(){return f}}}}function sa(a,b,d,c){for(var e={},f=0;f<d.length;f++){var h=d[f];e[h.fieldName]=h.fieldValue}this.createPublicInterface=function(){return{getType:function(){return a},getUrl:function(){return b},getAttachedRecords:function(){return e},getErrorReason:function(){return c}}}}function Ca(a,b,d,c,e){var f=[];d.split("\n").forEach(function(a){try{(a=H.trim(a))&&0<a.length&&f.push(new RegExp(a,
"gm"))}catch(b){}});e=c===Ca.ACTION_TYPE.REMOVE?"":e;this.getId=function(){return a};this.getName=function(){return b};this.getPattern=function(){return d};this.getActionType=function(){return c};this.getReplacement=function(){return e};this.execute=function(a){var b=!1;f.forEach(function(c){c.test(a)&&(a=a.replace(c,e),b=!0)});return{isRuleTriggered:b,message:a}}}function Ra(){O=null;p();if(W){if(U==P)return;for(var a=0;a<U.length&&a<P.length&&U.charAt(a)==P.charAt(a);a++);y.sendSneakPeek(a,P.substr(a));
U=P;P=""}else{if(ha==Y)return;y.sendTypingUpdate(Y);ha=Y;Y=!1}p()}function Za(){function a(){var a;if(a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)a=(a=navigator.userAgent.match(/OS (\d+)(_\d+)+/))?parseInt(a[1]):-1,a=14>a;return a}function b(a){var b="";if(a&&"string"===typeof a)return a;"ChatWindowButton"===a.type?b+="Button Selections:":"ChatWindowMenu"===a.type&&(b+="Menu Options:");a.items&&a.items.forEach(function(a){b+="\n\t"+a.text});return b}for(var d=ia+"/s/transcriptDownload",
c="",e=[],f=[],h=[],g=0;g<E.length;g++){var k=E[g].getPublicInterface(),t=k.getContent();t&&("string"!==typeof t&&(t=b(t)),a()?(e.push(k.getName()),f.push(k.getTimestamp()),h.push(t)):c+=k.getName()+" ("+k.getTimestamp()+"): "+t+" \n")}0<h.length&&a()&&(c=JSON.stringify({names:e,timestamps:f,messages:h}));var h=new Date,e=10>h.getMonth()+1?"0"+String(h.getMonth()+1):String(h.getMonth()+1),f=10>h.getDate()?"0"+String(h.getDate()):String(h.getDate()),h=String(h.getFullYear()),u=document.createElement("iframe");
u.style.display="none";u.name=(new Date).getTime()+"_"+Math.random();document.body.appendChild(u);H.addEventListener(u,"load",function(){u.parentNode.removeChild(u);n.parentNode.removeChild(n)});var n=document.createElement("form");n.style.display="none";n.method="POST";n.action=d;n.target=a()||(0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./))&&"snapins"===da?"_blank":u.name;document.body.appendChild(n);var d={type:"clientjs",text:c,name:e+f+h+"_transcript.txt",
isIOS:a(),isRTL:"rtl"===document.body.dir},N;for(N in d)c=document.createElement("input"),c.type="hidden",c.name=N,c.value=d[N],n.appendChild(c);n.submit()}function Sa(){function a(){function a(){I||(F=!0,l.connection.stop(),p())}q(r.CHASITOR_IDLE_TIMEOUT);u=!1;return y.sendChasitorIdleTimeout().complete(a).error(a)}function b(c){q(c||r.UPDATE_CHASITOR_IDLE_TIMEOUT_WARNING,t);0<t?(t--,n=setTimeout(b,1E3)):a()}function d(){u=!0;y.sendChasitorIdleTimeoutWarningEvent(Da.TRIGGERED);t=g;b(r.START_CHASITOR_IDLE_TIMEOUT_WARNING)}
function c(){n=setTimeout(d,h)}function e(){p();n&&(clearTimeout(n),n=null);u&&(q(r.CLEAR_CHASITOR_IDLE_TIMEOUT),u=!1,F||y.sendChasitorIdleTimeoutWarningEvent(Da.CLEARED))}var f=null,h=null,g=null,k=null,t=null,u=!1,n=null,N=!1,X=!1,Da={TRIGGERED:"triggered",CLEARED:"cleared"};this.createPublicInterface=function(){return{init:function(a,b,c,d){e();if(f=a)k=1E3*c,h=1E3*b,g=c-b,N=d;p()},start:function(){!n&&f&&c()},reset:function(){e();f&&c()},stop:e,pause:function(){n&&(X=!0,e())},resume:function(){X&&
(X=!1,c())},restore:function(){!n&&f&&N&&(N=!1,c())},getTimeoutData:function(){return{enabled:f,warningInSeconds:h/1E3,timeoutInSeconds:k/1E3,isRunning:null!==n}}}}}function Ta(a,b,d,c){c||(c=new Date);this.getSource=function(){return a};this.getType=function(){return b};this.getData=function(){return d};this.getDate=function(){return c}}function q(a,b){window.liveagent.dispatchEvent(a,b)}(function(){function a(){return function(){process.nextTick(f)}}function b(){return function(){C(f)}}function d(){var a=
0,b=new L(f),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function c(){var a=new MessageChannel;return a.port1.onmessage=f,function(){a.port2.postMessage(0)}}function e(){return function(){setTimeout(f,1)}}function f(){for(var a=0;A>a;a+=2)(0,I[a])(I[a+1]),I[a]=void 0,I[a+1]=void 0;A=0}function h(){try{var a=require("vertx");return C=a.runOnLoop||a.runOnContext,b()}catch(c){return e()}}function g(){}function k(a){try{return a.then}catch(b){return S.error=
b,S}}function t(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function u(a,b,c){B(function(a){var d=!1,e=t(c,b,function(c){d||(d=!0,b!==c?X(a,c):m(a,c))},function(b){d||(d=!0,l(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,l(a,e))},a)}function n(a,b){b._state===M?m(a,b._result):b._state===K?l(a,b._result):r(b,void 0,function(b){X(a,b)},function(b){l(a,b)})}function N(a,b,c){b.constructor===a.constructor&&c===O&&constructor.resolve===Q?n(a,b):c===S?l(a,S.error):void 0===c?m(a,b):"function"==
typeof c?u(a,b,c):m(a,b)}function X(a,b){a===b?l(a,new TypeError("You cannot resolve a promise with itself")):"function"==typeof b||"object"==typeof b&&null!==b?N(a,b,k(b)):m(a,b)}function Da(a){a._onerror&&a._onerror(a._result);q(a)}function m(a,b){a._state===J&&(a._result=b,a._state=M,0!==a._subscribers.length&&B(q,a))}function l(a,b){a._state===J&&(a._state=K,a._result=b,B(Da,a))}function r(a,b,c,d){var e=a._subscribers,n=e.length;a._onerror=null;e[n]=b;e[n+M]=c;e[n+K]=d;0===n&&a._state&&B(q,a)}
function q(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,n=a._result,t=0;t<b.length;t+=3)d=b[t],e=b[t+c],d?w(c,d,e,n):e(n);a._subscribers.length=0}}function p(){this.error=null}function w(a,b,c,d){var e,n,t,u,k="function"==typeof c;if(k){var g;try{g=c(d)}catch(h){g=(T.error=h,T)}if(e=g,e===T?(u=!0,n=e.error,e=null):t=!0,b===e)return void l(b,new TypeError("A promises callback cannot return that same promise."))}else e=d,t=!0;b._state!==J||(k&&t?X(b,e):u?l(b,n):a===M?m(b,e):a===K&&
l(b,e))}function z(a,b){try{b(function(b){X(a,b)},function(b){l(a,b)})}catch(c){l(a,c)}}function x(a){a[P]=V++;a._state=void 0;a._result=void 0;a._subscribers=[]}function v(a){this[P]=V++;this._result=this._state=void 0;this._subscribers=[];if(g!==a){if("function"!=typeof a)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof v)z(this,a);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}}function y(a,b){this._instanceConstructor=a;this.promise=new a(g);this.promise[P]||x(this.promise);F(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=Array(this.length),0===this.length?m(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&m(this.promise,this._result))):l(this.promise,Error("Array Methods must be provided an Array"))}var C,D,E,F=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},
A=0,B=function(a,b){I[A]=a;I[A+1]=b;A+=2;2===A&&(D?D(f):E())},G="undefined"!=typeof window?window:void 0,H=G||{},L=H.MutationObserver||H.WebKitMutationObserver,H="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),R="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,I=Array(1E3);E=H?a():L?d():R?c():void 0===G&&"function"==typeof require?h():e();var O=function(a,b){var c=this,d=new this.constructor(g);
void 0===d[P]&&x(d);var e=c._state;if(e){var n=arguments[e-1];B(function(){w(e,d,n,c._result)})}else r(c,d,a,b);return d},Q=function(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=new this(g);return X(b,a),b},P=Math.random().toString(36).substring(16),J=void 0,M=1,K=2,S=new p,T=new p,V=0;v.all=function(a){return(new W(this,a)).promise};v.race=function(a){var b=this;return new b(F(a)?function(c,d){for(var e=a.length,n=0;e>n;n++)b.resolve(a[n]).then(c,d)}:function(a,b){b(new TypeError("You must pass an array to race."))})};
v.resolve=Q;v.reject=function(a){var b=new this(g);return l(b,a),b};v._setScheduler=function(a){D=a};v._setAsap=function(a){B=a};v._asap=B;v.prototype={constructor:v,then:O,"catch":function(a){return this.then(null,a)}};var W=y;y.prototype._enumerate=function(){for(var a=this.length,b=this._input,c=0;this._state===J&&a>c;c++)this._eachEntry(b[c],c)};y.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;d===Q?(d=k(a),d===O&&a._state!==J?this._settledAt(a._state,b,a._result):
"function"!=typeof d?(this._remaining--,this._result[b]=a):c===v?(c=new c(g),N(c,a,d),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){b(a)}),b)):this._willSettleAt(d(a),b)};y.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===J&&(this._remaining--,a===K?l(d,c):this._result[b]=c);0===this._remaining&&m(d,this._result)};y.prototype._willSettleAt=function(a,b){var c=this;r(a,void 0,function(a){c._settledAt(M,b,a)},function(a){c._settledAt(K,b,a)})};var G=function(){var a;
if("undefined"!=typeof global)a=global;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw Error("polyfill failed because global object is unavailable in this environment");}var c=a.Promise;c&&"[object Promise]"===Object.prototype.toString.call(c.resolve())&&!c.cast||(a.Promise=v)},U={Promise:v,polyfill:G};"function"==typeof define&&define.amd?define(function(){return U}):"undefined"!=typeof module&&module.exports?module.exports=U:"undefined"!=typeof this&&
(this.ES6Promise=U);G()}).call(this);var B=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},m;!function(a){!function(a){!function(a){var b=function(a){function b(c){a.call(this,c);this.message=c;if(c=Error().stack){var d=c.split("\n");if(3<d.length){c="";for(var k=3;k<d.length;k++)c+=d[k],c+="\n"}this.stack=c}}return B(b,a),b}(Error);a.CustomError=b;b=function(a){function b(c,
d,k){a.call(this,"Invalid "+c+" state: expected '"+d+"' actual '"+k+"'")}return B(b,a),b}(b);a.InvalidStateError=b}(a.errors||(a.errors={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(a){!function(d){var c=function(){function c(){this.eventHandlers={}}return c.prototype.addEventListener=function(a,b,c){a=a.toString();this.eventHandlers.hasOwnProperty(a)||(this.eventHandlers[a]=[]);this.eventHandlers[a].push(new e(c,b))},c.prototype.removeEventListeners=function(a){var b=this;a?Object.keys(this.eventHandlers).forEach(function(c){b.eventHandlers[c]=
b.eventHandlers[c].filter(function(b,c){return b.listenerId!=a})}):this.eventHandlers={}},c.prototype.dispatchEvent=function(c,d){a.logging.debug("dispatchEvent eventType: "+c+" data:"+d);var e=this.eventHandlers[c.toString()];e?e.forEach(function(e){try{a.logging.debug("Handler:"+e),e.callback.call(window,d)}catch(u){a.logging.error("Error while handling event "+c.toString()+": "+u.message,u)}}):a.logging.error("No handler found for EventType:"+c.toString())},c.prototype.hasEventListener=function(a){a=
a.toString();return this.eventHandlers.hasOwnProperty(a)&&0<this.eventHandlers[a].length},c}();d.EventTarget=c;c=function(){function a(b){this.key=b}return a.prototype.toString=function(){return this.key},a}();d.EventType=c;var e=function(){return function(a,b){this.listenerId=a;this.callback=b}}()}(a.events||(a.events={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(a){!function(a){a.stringToJson=function(a){return void 0==a?null:a};a.numberToJson=function(a){return void 0==a?null:a}}(a.jsonUtil||
(a.jsonUtil={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(b){!function(b){!function(b){var d=function(){function b(){}return b.prototype.log=function(b,c,d,e){if(console.log){c=a.util.logging.logLevelToString(b)+": "+c+" ("+a.util.logging.getCaller()+")";b!=a.util.logging.Level.ERROR||d||(d=Error());var u;switch(b){case a.util.logging.Level.TRACE:u="LightGray";break;case a.util.logging.Level.DEBUG:u="DarkSeaGreen ";break;case a.util.logging.Level.INFO:u="Green";break;case a.util.logging.Level.WARN:u=
"GoldenRod";break;case a.util.logging.Level.ERROR:u="Red"}console.log("%c"+c,"color: "+u);d&&d.stack&&console.log(d.stack);null!=e&&(console.groupCollapsed?console.groupCollapsed():console.group&&console.group,console.log("%c"+e,"color: "+u),console.groupEnd&&console.groupEnd())}},b.prototype.useLogLevel=function(){return!0},b}();b.ConsoleLogger=d}(b.loggers||(b.loggers={}))}(b.logging||(b.logging={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(b){!function(b){!function(b){var d=function(){function b(){this.loggedRecords=
[];this.isConcacted=!1;this.startedTime=(new Date).getTime()}return b.prototype.log=function(c,d,e,u){var n=a.util.logging.getCaller();this.loggedRecords.push(new f(c,(new Date).getTime()-this.startedTime,d,n,e,u));this.loggedRecords.length>b.MAX_RECORDS&&(this.loggedRecords.shift(),this.isConcacted=!0)},b.prototype.save=function(){var b="";this.isConcacted&&(b+="Log Concactenated\n");var c=new Date,b=b+("Time: "+c.toString()+"\n"),b=b+("URL: "+window.location.href+"\n"),b=b+("User Agent: "+window.navigator.userAgent+
"\n");window.performance.memory&&(b+="Memory: { totalJSHeapSize: "+window.performance.memory.totalJSHeapSize,b+=" usedJSHeapSize: "+window.performance.memory.usedJSHeapSize,b+=" jsHeapSizeLimit: "+window.performance.memory.jsHeapSizeLimit,b+=" }\n");b+="\nMetrics:\n";a.util.metrics.getAll().forEach(function(a){return b+=a.toString()+"\n"});var b=b+"\nLog: \n",d=this.loggedRecords.map(function(a){return a.toString()});d.unshift(b);var d=new Blob(d),e=document.createElement("a");e.download="scrt_log_"+
c.getUTCMonth()+"_"+c.getUTCDate()+"_"+c.getUTCFullYear()+"_"+c.getUTCHours()+"_"+c.getUTCMinutes()+"_"+c.getUTCSeconds()+".txt";e.innerHTML="Download Log";e.href=window.URL.createObjectURL(d);e.style.display="none";window.document.body.appendChild(e);e.click()},b.prototype.useLogLevel=function(){return!1},b.MAX_RECORDS=1E3,b}();b.MemoryLogger=d;var f=function(){function b(c,d,e,u,n,f){this.level=c;this.msg=e;this.caller=u;this.cause=n;this.additionalData=f;c!=a.util.logging.Level.ERROR||n||(this.cause=
Error());this.offsetTime=d}return b.prototype.toString=function(){var b="["+this.offsetTime+"] "+a.util.logging.logLevelToString(this.level)+": "+this.msg+" ("+this.caller+")";return this.cause&&this.cause.stack&&(b+="\n",b+=this.cause.stack),null!=this.additionalData&&(b+="\n - Additional Data:",b+=this.additionalData),b+"\n"},b}()}(b.loggers||(b.loggers={}))}(b.logging||(b.logging={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(b){!function(b){function c(a,b,c,d){g.forEach(function(e){(!e.useLogLevel()||
f>=a)&&e.log(a,b.call(window),c,d)})}!function(a){a[a.ERROR=0]="ERROR";a[a.WARN=1]="WARN";a[a.INFO=2]="INFO";a[a.DEBUG=3]="DEBUG";a[a.TRACE=4]="TRACE"}(b.Level||(b.Level={}));var e=b.Level;b.error=function(a,b){"function"==typeof a?c(e.ERROR,a,b):"string"==typeof a&&c(e.ERROR,function(){return a},b)};b.warn=function(a,b){"function"==typeof a?c(e.WARN,a,b):"string"==typeof a&&c(e.WARN,function(){return a},b)};b.info=function(a){"function"==typeof a?c(e.INFO,a):"string"==typeof a&&c(e.INFO,function(){return a})};
b.debug=function(a){"function"==typeof a?c(e.DEBUG,a):"string"==typeof a&&c(e.DEBUG,function(){return a})};b.trace=function(a,b){"function"==typeof a?c(e.TRACE,a,null,b):"string"==typeof a&&c(e.TRACE,function(){return a},null,b)};b.setLevel=function(a){f=a};b.addLogger=function(a){g.push(a)};b.removeLogger=function(a){g=g.filter(function(b){return a!==b})};var f=e.WARN,h=new a.util.logging.loggers.MemoryLogger,g=[];g.push(new a.util.logging.loggers.ConsoleLogger);g.push(h);b.save=function(){h.save()};
b.logLevelToString=function(a){switch(a){case e.ERROR:return"ERROR";case e.WARN:return"WARNING";case e.INFO:return"INFO";case e.DEBUG:return"DEBUG";case e.TRACE:return"TRACE"}return""};b.getCaller=function(){var a=Error();if(a.stack){for(var a=a.stack.split("\n"),b=7;a.length>=b+1;){var c=a[b].trim();if(-1==c.indexOf("(native)"))return c;b++}if(8<=a.length)return a[7].trim()}return""}}(b.logging||(b.logging={}))}(a.util||(a.util={}))}(m||(m={}));!function(a){!function(a){!function(a){function b(){return Object.keys(e).map(function(a){return e[a]})}
var e={};!function(a){a[a.COUNTER=0]="COUNTER";a[a.HISTOGRAM=1]="HISTOGRAM";a[a.GAUGE=2]="GAUGE"}(a.MetricType||(a.MetricType={}));var f=a.MetricType;a.getCounter=function(a,b){b=a+"."+b;if(e[b])return e[b];var c=new h(b);return e[b]=c,c};a.getHistogram=function(a,b){b=a+"."+b;if(e[b])return e[b];var c=new g(b);return e[b]=c,c};a.getGauge=function(a,b,c){b=a+"."+b;if(e[b])return e[b];a=c?new u(b,c):new t(b);return e[b]=a,a};a.getAll=b;a.getCounters=function(){return b().filter(function(a){return a.metricType==
f.COUNTER})};a.getHistograms=function(){return b().filter(function(a){return a.metricType==f.HISTOGRAM})};a.getGauges=function(){return b().filter(function(a){return a.metricType==f.GAUGE})};a.deleteAll=function(){e={}};var h=function(){function a(b){this.count=0;this.metricType=f.COUNTER;this.name=b}return a.prototype.increment=function(){this.count++},a.prototype.decrement=function(){this.count--},a.prototype.add=function(a){this.count+=a},a.prototype.getCount=function(){return this.count},a.prototype.toString=
function(){return this.name+": { count: "+this.count+" }"},a}(),g=function(){function a(b){this.reservoir=[];this.count=0;this.metricType=f.HISTOGRAM;this.name=b}return a.prototype.update=function(b){if(this.count++,this.reservoir.length<a.MAX_RESERVOIR)this.reservoir.push(b);else{var c=Math.floor(Math.random()*this.count);c<a.MAX_RESERVOIR&&(this.reservoir[c]=b)}},a.prototype.getResults=function(){return new k(this.reservoir,this.count)},a.prototype.toString=function(){return this.name+": {\n"+this.getResults().toString()+
"\n}"},a.MAX_RESERVOIR=1028,a}(),k=function(){function a(b,c){this.sorted=b.slice();this.sorted.sort(function(a,b){return a-b});this.count=c}return a.prototype.getCount=function(){return this.count},a.prototype.getMedian=function(){return this.getQuantile(.5)},a.prototype.get75thPercentile=function(){return this.getQuantile(.75)},a.prototype.get95thPercentile=function(){return this.getQuantile(.95)},a.prototype.get99thPercentile=function(){return this.getQuantile(.99)},a.prototype.getMax=function(){return 0==
this.sorted.length?0:this.sorted[this.sorted.length-1]},a.prototype.getMin=function(){return 0==this.sorted.length?0:this.sorted[0]},a.prototype.getMean=function(){return 0==this.sorted.length?0:this.sorted.reduce(function(a,b){return a+b},0)/this.sorted.length},a.prototype.toString=function(){return"count: "+this.getCount()+"\nmedian: "+this.getMedian()+"\n75th percentile: "+this.get75thPercentile()+"\n95th percentile: "+this.get95thPercentile()+"\n99th percentile: "+this.get99thPercentile()+"\nmax: "+
this.getMax()+"\nmin: "+this.getMin()+"\nmean: "+this.getMean()},a.prototype.getQuantile=function(a){if(0==this.sorted.length)return 0;if(1==this.sorted.length)return this.sorted[0];a*=this.sorted.length+1;if(1>a)return this.sorted[0];if(a>=this.sorted.length)return this.sorted[this.sorted.length-1];var b=this.sorted[Math.floor(a)-1];return b+(a-Math.floor(a))*(this.sorted[Math.floor(a)]-b)},a}();a=function(){function a(b){this.name=b}return a.prototype.toString=function(){return this.name+": {\n"+
this.getValue().toString()+"\n}"},a}();var t=function(a){function b(c){a.call(this,c);this.metricType=f.GAUGE;this.value=0}return B(b,a),b.prototype.update=function(a){this.value=a},b.prototype.getValue=function(){return this.value},b}(a),u=function(a){function b(c,d){a.call(this,c);this.metricType=f.GAUGE;this.provider=d}return B(b,a),b.prototype.update=function(a){throw Error("You cannot update a Gauge created with a provider");},b.prototype.getValue=function(){return this.provider()},b}(a)}(a.metrics||
(a.metrics={}))}(a.util||(a.util={}))}(m||(m={}));B=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)};!function(a){!function(a){var d=function(){function a(b,c,d,e){this.apiVersion=b;this.method=c;this.sessionKey=d;this.params=e}return a.prototype.getHeaders=function(){var a=[new e("X-LIVEAGENT-API-VERSION",this.apiVersion)];return this.sessionKey&&a.push(new e("X-LIVEAGENT-SESSION-KEY",
this.sessionKey)),a},a.prototype.getMethodString=function(){if(this.method==c.GET)return"GET";if(this.method==c.POST)return"POST";if(this.method==c.DELETE)return"DELETE";throw Error("Unknown method: "+this.method);},a.prototype.getUrlPart=function(){var a=this.getBaseUrl();if(this.params){var b,c=!1;for(b in this.params)this.params.hasOwnProperty(b)&&(c?a+="\x26":(a+="?",c=!0),a+=encodeURIComponent(b)+"\x3d"+encodeURIComponent(this.params[b]))}return a},a.prototype.getBody=function(){return null},
a.prototype.expectError=function(){return!1},a}();a.Request=d;(function(a){a[a.POST=0]="POST";a[a.GET=1]="GET";a[a.DELETE=2]="DELETE"})(a.Method||(a.Method={}));var c=a.Method,e=function(){return function(a,b){this.name=a;this.value=b}}();a.HeaderImpl=e}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(d){var c=function(a){function c(b,d,f,t,u,n){a.call(this,b,f,u,n);this.sequence=t;this.noun=d}return B(c,a),c.prototype.getBaseUrl=function(){var a=this,c=this.noun.nounPrefix+
"/"+this.noun.nounName;this.method==b.Method.GET&&this.noun.properties&&Object.keys(this.noun.properties).forEach(function(b){c+="?";c+=encodeURIComponent(a.noun.nounName+"."+b);c+="\x3d";c+=encodeURIComponent(a.noun.properties[b])});return c},c.prototype.getHeaders=function(){var d=a.prototype.getHeaders.call(this);return this.sequence&&d.push(new b.HeaderImpl(c.SEQUENCE_HEADER,this.sequence.toString(10))),d},c.prototype.getBody=function(){return this.method!=b.Method.GET?null==this.noun.properties?
null:JSON.stringify(this.noun.properties):null},c.SEQUENCE_HEADER="X-LIVEAGENT-SEQUENCE",c}(a.connection.Request);d.NounRequest=c}(b.requests||(b.requests={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){var d=a.util.logging,c=function(c){function g(b,d,e){c.call(this);this.state=f.UNINITIALIZED;this.pollCount=this.expectedNextSequence=this.eventOffSet=0;this.durationMetrics=a.util.metrics.getHistogram("platform","pollDuration");this.reconnectMetrics=a.util.metrics.getCounter("platform",
"pollReconnects");this.timeoutMetrics=a.util.metrics.getCounter("platform","pollTimeouts");this.fatalErrorMetrics=a.util.metrics.getCounter("platform","pollFatalErrors");this.lastPollStart=0;this.maxReconnectMS=12E4;this.apiVersion=b;this.session=d;this.messenger=e}return B(g,c),g.prototype.start=function(){if(this.state!=f.UNINITIALIZED)throw Error("You cannot start an already started long poll loop!");d.info("Beginning long poll loop");this.state=f.POLLING;this.doPoll()},g.prototype.pausePolling=
function(){d.warn("Pausing polling. Setting PollingState to PAUSED. Current State is:"+this.state);window.clearTimeout(this.pollTimeoutId);window.clearTimeout(this.reconnectTimeoutId);this.pollTimeoutId=null;this.state=f.PAUSED},g.prototype.resumePolling=function(a){d.warn("Resuming polling. Setting PollingState to POLLING and calling doPoll.");a&&(d.warn("Reset Sequence:"+a),this.expectedNextSequence=0);this.state=f.POLLING;this.doPoll()},g.prototype.stop=function(){this.state!=f.UNINITIALIZED&&
(this.state=f.UNINITIALIZED,window.clearTimeout(this.pollTimeoutId),this.messenger.abort(this.currentPollMessageId))},g.prototype.getState=function(){return this.state},g.prototype.getEventOffSet=function(){return this.eventOffSet},g.prototype.doPoll=function(){var c=this;if(this.state!=f.POLLING&&this.state!=f.RECONNECTING)return void d.warn("Exiting long poll loop: state is "+this.state);var t=new e(this.apiVersion,this.session,this.state==f.RECONNECTING,this.expectedNextSequence-1,this.pollCount);
this.pollCount++;t=this.messenger.send(t,this.session.affinityToken);return this.lastPollStart=(new Date).getTime(),t.then(function(a){c.durationMetrics.update((new Date).getTime()-c.lastPollStart);a.getMessageId()==c.currentPollMessageId?(window.clearTimeout(c.pollTimeoutId),c.pollTimeoutId=null,c.state==f.RECONNECTING&&(d.info("Successfully re-established connection."),c.state=f.POLLING,c.sequentialPollTimeoutCount=0,c.dispatchEvent(b.Events.RECONNECTED,null),window.clearTimeout(c.reconnectTimeoutId)),
c.state==f.POLLING&&(c.handlePollResult(a)?c.doPoll():c.fatalError("Unknown successful response type: "+a.getStatus()+": "+a.getData()))):d.warn("Received poll result for poll request "+a.getMessageId()+" while polling for "+c.currentPollMessageId)},function(e){if(c.durationMetrics.update((new Date).getTime()-c.lastPollStart),window.clearTimeout(c.pollTimeoutId),c.pollTimeoutId=null,e instanceof a.connection.messenger.HttpError){d.error("Received bad poll response. Retrying. Error: "+e.message,e);
var t=e.status;if(d.debug("status code: "+t),403==t)return c.pausePolling(),void c.dispatchEvent(b.Events.RECONNECT,null);if(409==t)return void c.fatalError("Session out of sync");if(400==t||404==t||405==t||500==t)return void c.fatalError("fata error status:"+e.message);if(503==t)return d.warn("Service Unavailable received while polling. Pausing polling and dispatching Events.SERVICE_UNAVAILABLE Event."),c.pausePolling(),void c.dispatchEvent(b.Events.SERVICE_UNAVAILABLE,null);c.startReconnect();window.setTimeout(function(){return c.doPoll()},
1E3)}else c.fatalError("Unknown error type: "+e,e)}),this.currentPollMessageId=t.messageId,this.pollTimeoutId?void d.error("Unexpected poll while pollTimeout exists. Shutting down loop."):void(this.pollTimeoutId=window.setTimeout(function(){return c.handleTimeout()},1E3*this.session.pollTimeout))},g.prototype.serialize=function(){return{expectedNextSequence:this.expectedNextSequence,pollCount:this.pollCount}},g.prototype.deserialize=function(a){this.expectedNextSequence=a.expectedNextSequence;this.pollCount=
a.pollCount},g.prototype.setConnectionTimeout=function(a){this.maxReconnectMS=a},g.prototype.getConnectionTimeout=function(){return this.maxReconnectMS},g.prototype.handlePollResult=function(a){var c=this;if(204==a.getStatus())return d.debug("Received 204: NO CONTENT from long poll. Re-polling."),this.dispatchEvent(b.Events.LONG_POLL_COMPLETED,null),!0;if(200==a.getStatus()){var e=a.getData().sequence;return e=e-a.getData().messages.length+1,a.getData().offset&&(this.eventOffSet=a.getData().offset),
a.getData().messages.forEach(function(a){return e<c.expectedNextSequence?void d.info("Discarding duplicate sequence "+e):e>c.expectedNextSequence?void c.fatalError("Out of sync sequence. Expected "+c.expectedNextSequence+" received "+e):(e++,c.expectedNextSequence=e,d.info("Received message: "+a.type),d.trace(function(){return"Message Content: "},JSON.stringify(a.message,null,3)),void c.dispatchEvent(g.Events.RAW_MESSAGE_RECEIVED,a))}),!0}return!1},g.prototype.startReconnect=function(){var a=this;
this.state==f.POLLING&&(this.reconnectMetrics.increment(),this.state=f.RECONNECTING,this.dispatchEvent(b.Events.RECONNECTING,null),this.reconnectTimeoutId=window.setTimeout(function(){return a.handleReconnectTimeout()},this.getConnectionTimeout()))},g.prototype.handleReconnectTimeout=function(){this.fatalError("Reconnect timed out after "+this.getConnectionTimeout()+"ms")},g.prototype.handleTimeout=function(){var a=this;this.timeoutMetrics.increment();this.durationMetrics.update((new Date).getTime()-
this.lastPollStart);this.state!=f.UNINITIALIZED&&(d.warn("Client long poll did not complete in "+this.session.pollTimeout+" seconds. Attempting to re-establish connection."),this.sequentialPollTimeoutCount++,this.messenger.abort(this.currentPollMessageId),this.pollTimeoutId=null,this.startReconnect(),5<this.sequentialPollTimeoutCount?window.setTimeout(function(){a.doPoll()},2E3):this.doPoll())},g.prototype.fatalError=function(a,c){this.fatalErrorMetrics.increment();d.error(a,c);this.state=f.ERROR;
this.dispatchEvent(b.Events.FATAL_ERROR,{message:a})},g.Events={RAW_MESSAGE_RECEIVED:new a.util.events.EventType("rawMessageReceived")},g}(a.util.events.EventTarget);b.LongPollLoop=c;var e=function(b){function c(d,e,u,n,f){n={ack:n.toString(10),pc:f.toString(10)};u&&(n.reconnect="true");b.call(this,d,new a.connection.nouns.Messages,a.connection.Method.GET,null,e.sessionKey,n)}return B(c,b),c}(a.connection.requests.NounRequest);!function(a){a[a.UNINITIALIZED=0]="UNINITIALIZED";a[a.POLLING=1]="POLLING";
a[a.RECONNECTING=2]="RECONNECTING";a[a.ERROR=3]="ERROR";a[a.PAUSED=4]="PAUSED"}(b.PollingState||(b.PollingState={}));var f=b.PollingState}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){var d=function(){function a(b,c){this.messagePrefix=b;this.messageName=c}return a.prototype.toString=function(){return this.messagePrefix?this.messagePrefix+"/"+this.messageName:this.messageName},a.prototype.equals=function(b){return b instanceof a?b.messagePrefix==this.messagePrefix&&b.messageName==
this.messageName:!1},a}();a.MessageType=d}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){var d=function(){function c(){}return c.isMetricNoun=function(b){return a.util.logging.debug("MetricsStorage:      isMetricNoun : "+("System"===b.nounPrefix&&"UiMetrics"===b.nounName)),"System"===b.nounPrefix&&"UiMetrics"===b.nounName},c.getStoredMetrics=function(){return localStorage.getItem(c.STORED_METRICS_KEY)?JSON.parse(localStorage.getItem(c.STORED_METRICS_KEY)):null},c.storeMetrics=
function(d){c.isMetricNoun(d)&&!c.isAlreadyStored(d)&&(c.allowInvalidMetrics||b.MetricsUploader.areMetricsValid(d)?(a.util.logging.debug("MetricsStorage:      "+(c.hasStoredMetrics()?"Replacing":"Storing")+" metrics in localstorage"),localStorage.setItem(c.STORED_METRICS_KEY,JSON.stringify(d))):a.util.logging.debug("MetricsStorage:      ignoring invalid metrics for storage"))},c.hasStoredMetrics=function(){a.util.logging.debug("MetricsStorage:      hasAnyStoredMetrics : "+(null!=c.getStoredMetrics()));
var d=c.getStoredMetrics();return c.allowInvalidMetrics||b.MetricsUploader.areMetricsValid(d)?(a.util.logging.debug("MetricsStorage:      hasValidStoredMetrics : "+(null!=c.getStoredMetrics())),null!=c.getStoredMetrics()):(a.util.logging.debug("MetricsStorage: removing invalid stored metrics  ..."),c.clearStoredMetrics(),!1)},c.isAlreadyStored=function(b){var d=JSON.stringify(c.getStoredMetrics());b=JSON.stringify(b);return a.util.logging.debug("MetricsStorage:      isAlreadyStored : "+(d==b)),d==
b},c.removeStoredMetrics=function(b){c.isAlreadyStored(b)&&(a.util.logging.debug("MetricsStorage:      Removing stored metric"),c.clearStoredMetrics())},c.clearStoredMetrics=function(){a.util.logging.debug("MetricsStorage:      clearing storedMetrics ");localStorage.removeItem(c.STORED_METRICS_KEY)},c.STORED_METRICS_KEY="storedMetrics",c.allowInvalidMetrics=!1,c}();b.MetricsStorage=d}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){var d=function(){function c(){this.timeoutId=
null}return c.getTimeoutSeconds=function(){return c.timeoutMS/1E3},c.setTimeoutMS=function(b){c.timeoutMS=b;a.util.logging.debug("MetricsUploader: setting timeout to "+c.timeoutMS/1E3+" seconds")},c.setTimeoutMultiplier=function(b){c.timeoutMultiplier=b;a.util.logging.debug("MetricsUploader: setting timeout multiplier to "+c.timeoutMultiplier)},c.isStringValid=function(a){return null!=a&&""!==a},c.isNumberValid=function(a){return!(null==a||isNaN(a))},c.arePropertiesValid=function(a){return null==
a?!1:c.isStringValid(a.sessionId)},c.areGaugesValid=function(a){if(null==a)return!1;for(var b=0;b<a.length;b++){var d=a[b];if(!c.isNumberValid(d.value)||!c.isStringValid(d.name))return!1}return!0},c.areCountersValid=function(a){if(null==a)return!1;for(var b=0;b<a.length;b++){var d=a[b];if(!c.isNumberValid(d.value)||!c.isStringValid(d.name))return!1}return!0},c.areHistogramsValid=function(a){if(null==a)return!1;for(var b=0;b<a.length;b++){var d=a[b];if(!(c.isStringValid(d.name)&&c.isNumberValid(d.count)&&
c.isNumberValid(d.median)&&c.isNumberValid(d.mean)&&c.isNumberValid(d.min)&&c.isNumberValid(d.max)&&c.isNumberValid(d.percentile75th)&&c.isNumberValid(d.percentile95th)&&c.isNumberValid(d.percentile99th)))return!1}return!0},c.areMetricsValid=function(a){return null==a?!1:c.arePropertiesValid(a.properties)&&c.areGaugesValid(a.properties.gauges)&&c.areCountersValid(a.properties.counters)?!!c.areHistogramsValid(a.properties.histograms):!1},c.prototype.start=function(b){var d=this;this.session=b;a.util.logging.info("MetricsUploader started, scheduled for "+
c.getTimeoutSeconds()+" seconds out");this.timeoutId=window.setTimeout(function(){return d.upload(!0)},c.timeoutMS)},c.prototype.stop=function(){a.util.logging.debug("MetricsUploader: initiating stop");window.clearTimeout(this.timeoutId);this.timeoutId=null;this.upload(!1);a.util.logging.info("MetricsUploader: stopped")},c.prototype.upload=function(d){var f=this,h=null,g=c.timeoutMultiplier;if(null!=this.session&&null!=this.session.sessionId&&""!==this.session.sessionId){if(h=this.createNoun(a.util.metrics.getCounters(),
a.util.metrics.getHistograms(),a.util.metrics.getGauges(),this.session.sessionId),h.properties.isFinal=!d,b.MetricsStorage.hasStoredMetrics()){var k=b.MetricsStorage.getStoredMetrics();a.util.logging.info("MetricsUploader: trying to upload stored metric ...");a.connection.getConnection().send(k).then(function(a){b.MetricsStorage.removeStoredMetrics(k)})["catch"](function(b){a.util.logging.info("Failed to upload stored metrics")})}null!==h&&(c.areMetricsValid(h)?(a.util.logging.debug("MetricsUploader: trying to send metric ..."),
a.connection.getConnection().send(h).then(function(b){a.util.logging.debug("Sent successfully")})["catch"](function(d){a.util.logging.debug("Failed to upload metrics");b.MetricsStorage.storeMetrics(h);f.timeoutId=window.setTimeout(function(){return f.upload(!0)},c.timeoutMS)})):a.util.logging.info("MetricsUploader: suppressing invalid metrics ... "+JSON.stringify(h)));a.util.logging.info("MetricsUploader uploaded metrics")}else g=1;d&&(a.util.logging.debug("MetricsUploader scheduled for "+c.getTimeoutSeconds()*
g+" seconds out"),this.timeoutId=window.setTimeout(function(){return f.upload(!0)},c.timeoutMS*g))},c.prototype.createNoun=function(b,c,d,g){var k=new a.connection.nouns.UiMetrics;return k.properties.sessionId=g,k.properties.counters=b.map(function(b){var c=new a.connection.nouns.UiMetricsCounter;return c.name=b.name,c.value=b.getCount(),c}),k.properties.histograms=c.map(function(b){var c=new a.connection.nouns.UiMetricsHistogram;c.name=b.name;b=b.getResults();return c.count=b.getCount(),c.median=
b.getMedian(),c.mean=b.getMean(),c.min=b.getMin(),c.max=b.getMax(),c.percentile75th=b.get75thPercentile(),c.percentile95th=b.get95thPercentile(),c.percentile99th=b.get99thPercentile(),c}),k.properties.gauges=d.map(function(b){var c=new a.connection.nouns.UiMetricsGauge;return c.name=b.name,c.value=b.getValue(),c}),k},c.ONE_MINUTE=6E4,c.timeoutMS=c.ONE_MINUTE,c.timeoutMultiplier=5,c}();b.MetricsUploader=d}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){var d=a.util.logging,
c=function(c){function k(b,e,n){c.call(this);this.toSend=[];this.isSending=!1;this.outboundAckPending={};this.outboundAckReceived={};this.outboundSequence=1;this.timeoutCount=0;this.state=h.READY;this.synchronousDurationMetrics=a.util.metrics.getHistogram("platform","sendSynchronousDuration");this.asynchronousDurationMetrics=a.util.metrics.getHistogram("platform","sendAsynchronousDuration");this.queueDurationMetrics=a.util.metrics.getHistogram("platform","sendQueueDuration");this.failedNounMetrics=
a.util.metrics.getCounter("platform","sendFailedNouns");this.reconnectMetrics=a.util.metrics.getCounter("platform","sendReconnects");this.maxReconnectMS=12E4;this.messenger=b;this.apiVersion=e;this.session=n;d.info("QueueingSender() for session: "+this.session.sessionId)}return B(k,c),k.prototype.send=function(a,b){var c=this;d.info("QueueSender.send noun"+a);return new Promise(function(g,f){var h=new e(a,b,g,f,c.outboundSequence++);d.trace("Queueing noun "+h.getDebugLabel()+" for send");c.toSend.push(h);
c.sendCheck()})},k.prototype.resolveAsync=function(a){var b=this.outboundAckPending[a];b?(d.info("Resolving sequence "+a+" with async success"),this.asynchronousDurationMetrics.update((new Date).getTime()-b.sentTime),b.resolve(null),delete this.outboundAckPending[a]):(d.debug("Received async success result before saving promise. Saving until ready. Sequence: "+a),this.outboundAckReceived[a]=new f(!0))},k.prototype.rejectAsync=function(a,b){var c=this.outboundAckPending[a];c?(this.asynchronousDurationMetrics.update((new Date).getTime()-
c.sentTime),c.reject(b),d.info("Rejecting sequence "+a+" with async failure: "+b),delete this.outboundAckPending[a]):(d.debug("Received async failure result before saving promise. Saving until ready. Sequence: "+a+". Error: "+b),this.outboundAckReceived[a]=new f(!1,b))},k.prototype.getState=function(){return this.state},k.prototype.stop=function(){this.state!=h.STOPPED&&(this.state=h.STOPPED,this.currentlySending&&0<this.currentlySending.length&&(this.messenger.abort(this.currentSendMessageId),window.clearTimeout(this.sendTimeoutId),
this.toSend.forEach(function(a){d.debug("QueueSender.stop: Noun queued:"+a.noun.nounName)})))},k.prototype.pauseQueueing=function(){d.warn("pauseQueueing. Current State:"+this.state);this.stop();this.state=h.SERVICE_UNAVAILABLE;this.requeueCurrentlySending()},k.prototype.resumeQueueing=function(){d.warn("resumeQueueing. Previous State");this.state=h.READY;this.sendCheck()},k.prototype.resetSequence=function(){var a=this;this.isSending&&(window.clearTimeout(this.sendTimeoutId),this.isSending=!1,this.messenger.abort(this.currentSendMessageId),
this.currentSendMessageId=null,this.requeueCurrentlySending());this.outboundSequence=1;this.toSend.forEach(function(b){b.sequence=a.outboundSequence++});this.sendCheck()},k.prototype.serialize=function(){var a=this;return{toSend:this.currentlySending?this.toSend.concat(this.currentlySending).map(function(a){return a.serialize()}):this.toSend.map(function(a){return a.serialize()}),outboundAckPending:Object.keys(this.outboundAckPending).map(function(b){return a.outboundAckPending[b]}).map(function(a){return a.serialize()}),
outboundAckReceived:Object.keys(this.outboundAckReceived).map(function(b){return a.outboundAckReceived[b]}).map(function(a){return a.serialize()}),outboundSequence:this.outboundSequence}},k.prototype.deserialize=function(a){var b=this;this.toSend=a.toSend.map(function(a){return e.deserialize(a)});this.outboundAckPending={};a.outboundAckPending.map(function(a){return e.deserialize(a)}).forEach(function(a){return b.outboundAckPending[a.sequence]=a});this.outboundAckReceived={};a.outboundAckReceived.map(function(a){return e.deserialize(a)}).forEach(function(a){return b.outboundAckReceived[a.sequence]=
a});this.outboundSequence=a.outboundSequence;this.sendCheck()},k.prototype.setConnectionTimeout=function(a){this.maxReconnectMS=a},k.prototype.getConnectionTimeout=function(){return this.maxReconnectMS},k.prototype.sendCheck=function(){var b=this;if(this.state==h.STOPPED||this.state==h.ERROR||this.state==h.SERVICE_UNAVAILABLE)return void d.trace("Returning from sendCheck. Current state is:"+this.state);if(this.isSending)return void d.trace("Send already in progress.");if(1==this.toSend.length){this.isSending=
!0;var c=this.toSend.pop();this.currentlySending=[c];d.info("Sending one noun now "+c.getDebugLabel()+", sequence: "+c.sequence);d.trace(function(){return"Noun content: "},JSON.stringify(c.noun.properties,function(a,b){return c.noun.sensitiveProperties&&c.noun.sensitiveProperties.hasOwnProperty(a)?"\x3c\x3c\x3c filtered \x3e\x3e\x3e":b},3));this.sendTimeoutId=window.setTimeout(function(){return b.handleTimeout()},k.TIMEOUT_MS);var e=(new Date).getTime();this.lastSendStarted=e;c.sentTime=e;this.queueDurationMetrics.update(e-
c.queuedTime);var g=this.messenger.send(new a.connection.requests.NounRequest(this.apiVersion,c.noun,c.method,c.sequence,this.session.sessionKey),this.session.affinityToken);g.then(this.createResponseHandler(),this.createErrorHandler());this.currentSendMessageId=g.messageId}else if(1<this.toSend.length){for(var f=[];0<this.toSend.length;)f.push(this.toSend.shift());g=new a.connection.nouns.MultiNoun;g.properties.nouns=f.map(function(b){var c=new a.connection.nouns.MultiNounPropertiesNounWrapper;return c.prefix=
b.noun.nounPrefix,c.noun=b.noun.nounName,c.object=b.noun.properties,c});this.isSending=!0;this.currentlySending=f;d.info("Sending multinoun consisting of "+f.length+" nouns:");e=(new Date).getTime();f.forEach(function(a,c){d.info("Noun "+c+" of "+f.length+": "+a.getDebugLabel()+", sequence: "+a.sequence);d.trace(function(){return"Noun content: "},JSON.stringify(a.noun.properties,function(b,c){return a.noun.sensitiveProperties&&a.noun.sensitiveProperties.hasOwnProperty(b)?"\x3c\x3c\x3c filtered \x3e\x3e\x3e":
c},3));a.sentTime=e;b.queueDurationMetrics.update(e-a.queuedTime)});this.sendTimeoutId=window.setTimeout(function(){return b.handleTimeout()},k.TIMEOUT_MS);this.lastSendStarted=e;g=this.messenger.send(new a.connection.requests.NounRequest(this.apiVersion,g,a.connection.Method.POST,f[f.length-1].sequence,this.session.sessionKey),this.session.affinityToken);g.then(this.createResponseHandler(),this.createErrorHandler());this.currentSendMessageId=g.messageId}},k.prototype.handleTimeout=function(){d.debug("Timeout when sending message with sequence "+
this.currentlySending[0].sequence+" messageId:"+this.currentSendMessageId+" sessionId:"+this.session.sessionId);this.timeoutCount++;this.messenger.abort(this.currentSendMessageId);this.timeoutCount>=this.getConnectionTimeout()/k.TIMEOUT_MS?(d.error("Maximum timeouts exceeded in send. Fatal error"),this.state=h.ERROR,this.dispatchEvent(b.Events.FATAL_ERROR,{message:"Maximum timeouts exceeded in send"})):(1>=this.timeoutCount&&(d.debug("this.timeoutCount \x3c\x3d 1"),this.state=h.RECONNECTING,this.dispatchEvent(b.Events.RECONNECTING,
null)),this.requeueCurrentlySending(),this.isSending=!1,this.currentlySending=null,this.sendCheck())},k.prototype.requeueCurrentlySending=function(){if(this.currentlySending)for(;0<this.currentlySending.length;){var a=this.currentlySending.pop();this.toSend.unshift(a)}this.currentlySending=null},k.prototype.createResponseHandler=function(){var a=this;return function(c){if(a.synchronousDurationMetrics.update((new Date).getTime()-a.lastSendStarted),window.clearTimeout(a.sendTimeoutId),a.state==h.RECONNECTING&&
(a.timeoutCount=0,a.state=h.READY,a.dispatchEvent(b.Events.RECONNECTED,null)),a.currentSendMessageId=null,202==c.getStatus()){if(1==a.currentlySending.length){var e=a.currentlySending[0].sequence;return a.handleAsyncResponse(e,a.currentlySending[0]),d.debug("Waiting for async result from sequence "+e),a.isSending=!1,a.currentlySending=null,void a.sendCheck()}var g=c.getData().ack;g.sort();for(var f=(a.outboundSequence-a.currentlySending.length,g.length-1);0<=f;f--)for(var e=g[f],k=0;k<a.currentlySending.length;k++){var l=
a.currentlySending[k];if(null!=l&&e===l.sequence){a.currentlySending[k]=null;a.handleAsyncResponse(e,l);d.debug("Waiting for async result from sequence "+e);break}d.debug("item\x3d"+l+", sequence\x3d"+e)}if(a.currentlySending=a.currentlySending.filter(function(a){return null!=a}),!(0<a.currentlySending.length))return a.isSending=!1,a.currentlySending=null,void a.sendCheck();d.debug("Received partial async partial success response for sequence "+e)}else d.debug("Received successful response for noun sequence "+
a.currentlySending[0].sequence);a.isSending=!1;a.currentlySending.forEach(function(a){try{a.resolve(c)}catch(b){d.error("Error encountered when calling resolve handler for "+a.getDebugLabel(),b)}});a.currentlySending=null;a.sendCheck()}},k.prototype.handleAsyncResponse=function(a,b){d.trace("Received response indicating async result for noun sequence "+a);var c=this.outboundAckReceived[a];c?(this.asynchronousDurationMetrics.update((new Date).getTime()-b.sentTime),c.isSuccess?b.resolve(null):b.reject(c.error)):
this.outboundAckPending[a]=b},k.prototype.createErrorHandler=function(){var c=this;return function(e){if(c.synchronousDurationMetrics.update((new Date).getTime()-c.lastSendStarted),window.clearTimeout(c.sendTimeoutId),c.currentSendMessageId=null,c.isSending=!1,e instanceof a.connection.messenger.HttpError){var n=e.status;if(403==n)return c.pauseQueueing(),void c.dispatchEvent(b.Events.RECONNECT,null);if(400==n||404==n||405==n||500==n||409==n)return c.failNouns(e),c.state=h.ERROR,void c.dispatchEvent(b.Events.FATAL_ERROR,
{message:"QueueSender Fatal error: "+e.message});if(503==n)return d.debug("Service Unavailable received in QueueSender. Dispatching Events.SERVICE_UNAVAILABLE Event."),c.pauseQueueing(),void c.dispatchEvent(b.Events.SERVICE_UNAVAILABLE,null);c.storeMetricNouns()}if(d.warn("Unexpected response from server. Retrying. Error: "+e.message,e),c.state==h.READY)c.reconnectMetrics.increment(),c.errorStarted=(new Date).getTime(),c.state=h.RECONNECTING,c.dispatchEvent(b.Events.RECONNECTING,null);else if((new Date).getTime()-
c.errorStarted>c.getConnectionTimeout())return c.dispatchEvent(b.Events.FATAL_ERROR,{message:"Reconnect timeout exceeded. Original message: "+e.message}),c.failNouns(e),void window.setTimeout(function(){return c.sendCheck()},1E3);c.requeueCurrentlySending();window.setTimeout(function(){return c.sendCheck()},1E3)}},k.prototype.failNouns=function(a){var b=this;this.currentlySending.forEach(function(c){b.failedNounMetrics.increment();try{c.reject(a)}catch(e){d.error("Error encountered when calling reject handler for "+
c.getDebugLabel(),e),d.error("Suppressed error was ",a)}})},k.prototype.storeMetricNouns=function(){this.currentlySending.forEach(function(a){return b.MetricsStorage.storeMetrics(a.getNoun())})},k.TIMEOUT_MS=2E4,k}(a.util.events.EventTarget);b.QueueingSender=c;var e=function(){function a(b,c,d,e,g){this.noun=b;this.method=c;this.resolve=d;this.reject=e;this.sequence=g;this.queuedTime=(new Date).getTime()}return a.deserialize=function(b){return new a(b.noun,b.method,function(){return null},function(){return null},
b.sequence)},a.prototype.serialize=function(){return{method:this.method,noun:this.noun,sequence:this.sequence}},a.prototype.getNoun=function(){return this.noun},a.prototype.getDebugLabel=function(){return this.noun.nounPrefix+"/"+this.noun.nounName},a}(),f=function(){return function(a,b){this.isSuccess=a;this.error=b}}();!function(a){a[a.READY=0]="READY";a[a.RECONNECTING=1]="RECONNECTING";a[a.ERROR=2]="ERROR";a[a.STOPPED=3]="STOPPED";a[a.SERVICE_UNAVAILABLE=4]="SERVICE_UNAVAILABLE"}(b.SendingState||
(b.SendingState={}));var h=b.SendingState}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){var d=function(){function a(){this.offset=this.affinityToken=this.pollTimeout=this.sessionKey=this.sessionId=null}return a.prototype.clear=function(){this.offset=this.affinityToken=this.pollTimeout=this.sessionKey=this.sessionId=null},a}();a.Session=d}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){new (function(){function b(){this.createMemoryMetrics()}return b.prototype.createMemoryMetrics=
function(){try{if(window.performance&&window.performance.memory){var b=window.performance.memory;a.util.metrics.getGauge("userAgent","usedJSHeapSize",function(){return b.usedJSHeapSize});a.util.metrics.getGauge("userAgent","jsHeapSizeLimit",function(){return b.jsHeapSizeLimit});a.util.metrics.getGauge("userAgent","percentMemoryUsed",function(){return Math.round(b.usedJSHeapSize/b.jsHeapSizeLimit*1E4)/100})}}catch(d){a.util.logging.error("Could not create memory metrics",d)}},b}())}(a.connection||
(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(b){!function(a){a[a.UNINITIALIZED=0]="UNINITIALIZED";a[a.EXTERNAL_CREATION=1]="EXTERNAL_CREATION";a[a.READY=2]="READY"}(b.ExternalState||(b.ExternalState={}));var c=b.ExternalState,e=a.util.logging,f=function(){function f(a,b,d,e){this.sequence=0;this.currentState=c.UNINITIALIZED;this.pendingMessages=[];this.outgoingMessages={};this.abortedMessageIds=[];this.chatUrl=a;this.contentUrl=b;this.apiVersion=d;this.proxyUrl=e}return f.prototype.start=
function(){var b=this;if(this.currentState!=c.UNINITIALIZED)throw new a.util.errors.InvalidStateError("ExternalMessenger",c.UNINITIALIZED,this.currentState);return new Promise(function(a,d){b.currentState=c.EXTERNAL_CREATION;b.startResolver=a;b.doStart()})},f.prototype.send=function(a,b){var d=this,f=new h(this.sequence++,a.getHeaders(),b,a.getMethodString(),a.getUrlPart(),a.getBody(),a.expectError()),k=new Promise(function(a,b){var n=new g(f,a,b);d.currentState!=c.READY?(d.pendingMessages.push(n),
e.debug("Queueing message before external sender is ready")):d.doSend(n)});return k.messageId=f.id,k},f.prototype.abort=function(a){e.debug("Aborting message EXT-"+a);this.pendingMessages=this.pendingMessages.filter(function(b){return b.message.id!=a});this.outgoingMessages[a]?(e.debug("Deleting message EXT-"+a),delete this.outgoingMessages[a],this.doAbort(a),this.abortedMessageIds.push(a)):e.debug("Message EXT-"+a+" not found to abort")},f.prototype.started=function(){var b=this;if(this.currentState!=
c.EXTERNAL_CREATION)throw new a.util.errors.InvalidStateError("ExternalMessenger",c.EXTERNAL_CREATION,this.currentState);this.currentState=c.READY;e.info("External Messenger Initialized");this.startResolver();this.pendingMessages.forEach(function(a){return b.doSend(a)});this.pendingMessages=[]},f.prototype.responseReceived=function(a,c,f,g){var h=this.outgoingMessages[a];if(delete this.outgoingMessages[a],!h){var t=!1;return this.abortedMessageIds=this.abortedMessageIds.filter(function(b){return b==
a?(t=!0,!1):!0}),void(t||e.warn("Received reply for unknown message ID: EXT-"+a))}if(c)h.resolve(new k(f,g,a)),e.trace("Received successful result for EXT-"+a);else{h.message.expectError?e.debug("Received "+f+" in external sender from request for "+h.message.urlPart):e.error("Bad result in external sender for EXT-"+a+" from "+h.message.method+" to "+h.message.urlPart+" status code: "+f+": "+g,l);var l=new b.HttpError("Received status code "+f+" from server over external sender: "+g+" for EXT-"+a,
f,g);h.reject(l)}},f.prototype.doSend=function(a){e.trace(function(){return"Sending (EXT-"+a.message.id+") "+a.message.urlPart+" via "+a.message.method+" over external interface"});this.outgoingMessages[a.message.id]=a;this.externalSend(a)},f.AFFINITY_HEADER="X-LIVEAGENT-AFFINITY",f}();b.AbstractExternalMessenger=f;var h=function(){return function(b,c,d,e,g,h,k){this.id=b;this.headers=c;this.method=e;this.urlPart=g;this.data=h;this.expectError=k;this.headers||(this.headers=[]);this.headers.push(new a.connection.HeaderImpl(f.AFFINITY_HEADER,
d?d:"null"))}}();b.OutgoingMessage=h;var g=function(){return function(a,b,c){this.message=a;this.resolve=b;this.reject=c}}();b.OutgoingMessageWrapper=g;var k=function(){function a(b,c,d){this.status=b;this.rawData=c;this.messageId=d}return a.prototype.getStatus=function(){return this.status},a.prototype.getData=function(){if(!this.data)try{this.data=JSON.parse(this.rawData)}catch(a){throw Error("Unable to parse JSON string: '"+this.data+"'");}return this.data},a.prototype.getRawData=function(){return this.rawData},
a.prototype.getMessageId=function(){return this.messageId},a}();b.OutgoingMessageResult=k}(b.messenger||(b.messenger={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(b){var c=a.util.logging,e=function(e){function h(){e.apply(this,arguments)}return B(h,e),h.prototype.isAvailable=function(){return"undefined"!=typeof window.postMessage},h.prototype.doStart=function(){this.addMessageHook();this.createIframe()},h.prototype.doAbort=function(a){this.sendToFrame(JSON.stringify({action:"abort",
id:a}))},h.prototype.externalSend=function(a){a=a.message;this.sendToFrame(JSON.stringify({action:"send",async:!0,id:a.id,headers:a.headers,method:a.method,url:this.chatUrl+a.urlPart,data:a.data,expectError:a.expectError}))},h.prototype.sendToFrame=function(a){this.iframe.contentWindow.postMessage(a,"*")},h.prototype.addMessageHook=function(){var a=this;if(window.addEventListener)window.addEventListener("message",function(b){return a.cdmMessageReceived(b)},!1);else{if(!window.attachEvent)throw Error("Could not attach event listener");
window.attachEvent("onmessage",function(b){return a.cdmMessageReceived(b)},!1)}c.debug("Added CDM message hook")},h.prototype.createIframe=function(){var a=this.chatUrl+"/rest/cdm?version\x3d"+this.apiVersion+"\x26redirect\x3dtrue";this.proxyUrl&&(a+="\x26proxy\x3d"+encodeURIComponent(this.proxyUrl));this.iframe=document.createElement("iframe");this.iframe.src=a;this.iframe.style.display="none";document.body.appendChild(this.iframe);c.debug("CDM frame created")},h.prototype.cdmMessageReceived=function(e){if(this.iframe&&
e.source==this.iframe.contentWindow)if(e=JSON.parse(e.data),"init"==e.result)e=e.url,this.chatUrl=e.substr(0,e.indexOf("/rest/cdm"))+"/rest/",c.info("CDM Initialized"),this.started();else{if(this.currentState!=b.ExternalState.READY)throw new a.util.errors.InvalidStateError("cdm",b.ExternalState.READY,this.currentState);switch(e.result){case "success":this.responseReceived(e.id,!0,e.status,e.data);break;case "error":this.responseReceived(e.id,!1,e.status,e.data);break;default:var f=Error("Unexpected result: "+
e.result);this.responseReceived(e.id,!1,e.status,f.message);c.error("Invalid result to send of EXT-"+e.id+" from CDM",f)}}},h}(b.AbstractExternalMessenger);b.Cdm=e}(b.messenger||(b.messenger={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(b){var c=a.util.logging;b.createMessenger=function(b,d,e,k){b=new a.connection.messenger.Cdm(b,d,e,k);if(b.isAvailable())return c.info("Selected CDM messenger"),b;throw Error("Could not locate an available messenger");};var e=
function(a){function b(c,d,e){a.call(this,c);this.status=d;this.data=e}return B(b,a),b}(a.util.errors.CustomError);b.HttpError=e}(b.messenger||(b.messenger={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(b){var c=function(b){function c(d,f){b.call(this,f,a.connection.Method.DELETE,d);this.sessionKeyToDelete=d}return B(c,b),c.prototype.getBaseUrl=function(){return"System/SessionId/"+this.sessionKeyToDelete},c}(a.connection.Request);b.SessionDeleteRequest=c}(b.requests||
(b.requests={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){var d,c=a.util.logging,e=a.util.jsonUtil,f=null;b.initialize=function(a,b,c){d=c;f||(f=new g(a,b))};b.isInitialized=function(){return null!=f};b.getConnection=function(){return f};b.deserialize=function(a){f&&c.error("Attempting to deserialize with existing connection");a=JSON.parse(a);d=a.apiVersion;return f=new g(a.serviceUrl,a.contentUrl),f.deserialize(a),f};var h=function(){function b(){}return b.RECONNECTING=
new a.util.events.EventType("reconnecting"),b.RECONNECTED=new a.util.events.EventType("reconnected"),b.FATAL_ERROR=new a.util.events.EventType("fatalError"),b.MESSAGE_RECEIVED=new a.util.events.EventType("messageReceived"),b.AFFINITY_TOKEN_CHANGED=new a.util.events.EventType("affinityTokenChanged"),b.SERVICE_UNAVAILABLE=new a.util.events.EventType("serviceUnavailable"),b.RECONNECT=new a.util.events.EventType("reconnect"),b.REINIT=new a.util.events.EventType("reinit"),b.LONG_POLL_COMPLETED=new a.util.events.EventType("longPollCompleted"),
b}();b.Events=h;var g=function(f){function g(e,h){f.call(this);this.session=new b.Session;this.jsErrorMetrics=a.util.metrics.getCounter("platform","connectionJsErrors");this.metricsUploader=new b.MetricsUploader;var k=this.getWindowParameter("proxy");this.serviceEndpoint=e;this.contentEndpoint=h;this.messenger=a.connection.messenger.createMessenger(this.serviceEndpoint,this.contentEndpoint,d,k);this.startPromise=this.messenger.start();var l=this,m;for(m in this)this[m]instanceof Function&&function(a){var b=
this[a];this[a]=function(){try{return b.apply(this,arguments)}catch(d){l.jsErrorMetrics.increment(),c.error("Error while calling scrt.connection."+a+(d.message?": "+d.message:""),d)}}}.call(this,m)}return B(g,f),g.prototype.getWindowParameter=function(a){for(var b=window.location.search.substring(1).split("\x26"),c=0;c<b.length;c++){var d=b[c].split("\x3d");if(d[0]===a&&1<d.length)return this.escapeToHtml(d[1])}return null},g.prototype.escapeToHtml=function(a){return null===a||void 0===a||""===a?
"":a.replace(/[&<>"'\u00a9\u2028\u2029]/g,this.htmlEscapeChararacter)},g.prototype.htmlEscapeChararacter=function(a){switch(a){case "'":return"\x26#39;";case "\x26":return"\x26amp;";case "\x3c":return"\x26lt;";case "\x3e":return"\x26gt;";case '"':return"\x26quot;";case "\u00a9":return"\x26copy;";case "\u2028":return"\x3cbr\x3e";case "\u2029":return"\x3cp\x3e";default:return a}},g.prototype.connect=function(e,f){var g=this;try{return this.sessionPromise=this.startPromise.then(function(){var c={"SessionId.ClientType":e};
return g.messenger.send(new a.connection.requests.NounRequest(d,new a.connection.nouns.SessionId,b.Method.GET,null,null,c),null)}).then(function(a){return g.session.sessionId=a.getData().id,g.session.sessionKey=a.getData().key,g.session.pollTimeout=a.getData().clientPollTimeout,g.session.affinityToken=a.getData().affinityToken,c.info("Session "+g.session.sessionId+" initialized with affinity for "+g.session.affinityToken+" and a poll timeout of "+g.session.pollTimeout),g.longPollLoop=new b.LongPollLoop(d,
g.session,g.messenger),g.startPolling(),f&&(c.info("this.dispatchEvent(Events.REINIT, null)"),g.dispatchEvent(h.REINIT,null)),c.info("connection.connect: Session ready"),g.metricsUploader.start(g.session),g.session.sessionId})["catch"](function(a){throw c.error("Could not initialize session",a),a;}),this.sessionPromise}catch(k){throw c.error("Could not start messenger",k),k;}},g.prototype.start=function(a){return this.sessionPromise?this.sessionPromise:this.connect(a,!1)},g.prototype.restart=function(a,
e,f,g){var h=this;if(c.info("connection.restart: starting"),this.sessionPromise)throw Error("You cannot restart an already started session.");this.session.sessionId=a;this.session.sessionKey=e;this.session.affinityToken=f;this.session.pollTimeout=g;c.info("Session "+this.session.sessionId+" restored with affinity for "+this.session.affinityToken+" and a poll timeout of "+this.session.pollTimeout);this.sessionPromise=this.startPromise.then(function(){return h.longPollLoop=new b.LongPollLoop(d,h.session,
h.messenger),h.startPolling(),h.metricsUploader.start(h.session),c.info("connection.restart: Session ready"),h.session.sessionId})},g.prototype.reconnect=function(){c.warn("Session invalid. Trying to reconnect. Pausing Polling");this.longPollLoop.pausePolling();c.warn("Pausing SendQueue");this.sendQueue.pauseQueueing();this.metricsUploader.stop();this.connect("reconnect",!0)},g.prototype.stop=function(){c.info("connection.stop");this.abort();this.messenger.send(new a.connection.requests.SessionDeleteRequest(this.session.sessionKey,
d),this.session.affinityToken).then(function(){return c.info("Remote session deleted")});this.stopped()},g.prototype.stopped=function(){c.info("connection.stopped");this.abort();this.session.clear();this.sessionPromise=null},g.prototype.abort=function(){this.metricsUploader.stop();this.longPollLoop.stop();this.sendQueue.stop();c.info("Connection aborted by request")},g.prototype.send=function(a){return this.sendQueue.send(a,b.Method.POST)},g.prototype.get=function(c){return this.messenger.send(new a.connection.requests.NounRequest(d,
c,b.Method.GET,null,this.session.sessionKey),this.session.affinityToken).then(function(a){if(200==a.status)return JSON.parse(a.rawData);throw Error("Unexpected result: "+JSON.stringify(a));})},g.prototype.getSessionId=function(){return this.session.sessionId},g.prototype.getSessionKey=function(){return this.session.sessionKey},g.prototype.getAffinityToken=function(){return this.session.affinityToken},g.prototype.getMessenger=function(){return this.messenger},g.prototype.getApiVersion=function(){return d},
g.prototype.isServiceUnavailable=function(){return this.state==a.connection.Events.SERVICE_UNAVAILABLE},g.prototype.isRunning=function(){return null!=this.session.sessionId},g.prototype.serialize=function(){return JSON.stringify({serviceUrl:e.stringToJson(this.serviceEndpoint),contentUrl:e.stringToJson(this.contentEndpoint),apiVersion:e.stringToJson(d),sessionId:e.stringToJson(this.session.sessionId),sessionKey:e.stringToJson(this.session.sessionKey),affinityToken:e.stringToJson(this.session.affinityToken),
pollTimeout:e.numberToJson(this.session.pollTimeout),outgoing:void 0==this.sendQueue?null:this.sendQueue.serialize(),incoming:void 0==this.longPollLoop?null:this.longPollLoop.serialize()})},g.prototype.deserialize=function(a){if(a.apiVersion!=d)throw Error("Deserialization is not supported across versions. Serialized version: "+a.apiVersion+" expected version: "+d);if(this.session.sessionId)throw Error("You cannot deserialize a session once the connection has started");this.serviceEndpoint=a.serviceUrl;
this.contentEndpoint=a.contentUrl;this.session.sessionId=a.sessionId;this.session.sessionKey=a.sessionKey;this.session.affinityToken=a.affinityToken;this.session.pollTimeout=a.pollTimeout;c.info("Session "+this.session.sessionId+" deserialized with affinity for "+this.session.affinityToken+" and a poll timeout of "+this.session.pollTimeout);this.longPollLoop=new b.LongPollLoop(d,this.session,this.messenger);null!=a.incoming&&this.longPollLoop.deserialize(a.incoming);this.startPolling();null!=a.outgoing&&
this.sendQueue.deserialize(a.outgoing);c.info("Deserialized session ready")},g.prototype.setConnectionTimeout=function(a){this.longPollLoop.setConnectionTimeout(a);this.sendQueue.setConnectionTimeout(a)},g.prototype.startPolling=function(){var c=this;this.addEventListener(h.RECONNECT,function(){return c.reconnect()});this.longPollLoop.addEventListener(h.LONG_POLL_COMPLETED,function(){return c.dispatchEvent(h.LONG_POLL_COMPLETED,null)});this.addEventListener(h.SERVICE_UNAVAILABLE,function(){return c.serviceUnavailable()});
this.longPollLoop.addEventListener(h.RECONNECT,function(){return c.reconnect()});this.longPollLoop.addEventListener(h.SERVICE_UNAVAILABLE,function(){return c.serviceUnavailable()});this.longPollLoop.addEventListener(b.LongPollLoop.Events.RAW_MESSAGE_RECEIVED,function(a){return c.handleRawMessage(a)});this.relayEvents(this.longPollLoop,h.MESSAGE_RECEIVED);this.longPollLoop.addEventListener(h.FATAL_ERROR,function(a){c.sendQueue.stop();c.dispatchEvent(h.FATAL_ERROR,a);c.stopped()});this.relayEvents(this.longPollLoop,
h.RECONNECTING);this.relayEvents(this.longPollLoop,h.RECONNECTED);this.sendQueue=new a.connection.QueueingSender(this.messenger,d,this.session);this.sendQueue.addEventListener(h.SERVICE_UNAVAILABLE,function(){return c.serviceUnavailable()});this.relayEvents(this.sendQueue,h.FATAL_ERROR);this.sendQueue.addEventListener(h.FATAL_ERROR,function(a){c.longPollLoop.stop();c.dispatchEvent(h.FATAL_ERROR,a);c.stopped()});this.longPollLoop.addEventListener(h.RECONNECTING,function(){return c.sendQueue.getState()!=
b.SendingState.RECONNECTING?c.dispatchEvent(h.RECONNECTING,null):null});this.sendQueue.addEventListener(h.RECONNECTING,function(){return c.longPollLoop.getState()!=b.PollingState.RECONNECTING?c.dispatchEvent(h.RECONNECTING,null):null});this.longPollLoop.addEventListener(h.RECONNECTED,function(){return c.sendQueue.getState()==b.SendingState.READY?c.dispatchEvent(h.RECONNECTED,null):null});this.sendQueue.addEventListener(h.RECONNECTED,function(){return c.longPollLoop.getState()==b.PollingState.POLLING?
c.dispatchEvent(h.RECONNECTED,null):null});this.hasEventListener(h.AFFINITY_TOKEN_CHANGED)||this.addEventListener(h.AFFINITY_TOKEN_CHANGED,function(a){return c.affinityTokenChanged(a.affinityToken,a.resetSequence)});this.longPollLoop.start()},g.prototype.serviceUnavailable=function(){var b=this;c.warn("Service Unavailable. Getting new Affinity Token");this.isServiceUnavailable()||(c.warn("Affinity token changed. Re-syncing. Pausing Polling"),this.longPollLoop.pausePolling(),c.warn("Pausing SendQueue"),
this.sendQueue.pauseQueueing(),this.messenger.send(new k(d,this.session,this.longPollLoop.getEventOffSet()),null).then(function(a){200==a.getStatus()?(a=a.getData().messages[0].message,c.debug("Received new affinity token: "+a.affinityToken),b.dispatchEvent(h.AFFINITY_TOKEN_CHANGED,a)):b.fatalError("Invalid result from reconnect session request ["+a.getStatus()+"]: "+a.getRawData())},function(a){b.fatalError("Invalid response to reconnect session request: "+a,a instanceof Error?a:null)}),this.state=
a.connection.Events.SERVICE_UNAVAILABLE)},g.prototype.affinityTokenChanged=function(a,b){c.debug("affinityTokenChanged:"+a+". Reset Sequence"+b);b&&this.sendQueue.resetSequence();this.session.affinityToken=a;c.warn("new Affinity token:"+this.session.affinityToken);this.longPollLoop.resumePolling(b);this.sendQueue.resumeQueueing();this.state=null},g.prototype.handleRawMessage=function(a){var c,d,e=a.type.split("/");1<e.length?(c=e[0],d=e[1]):d=e[0];a={type:new b.MessageType(c,d),body:a.message};this.dispatchMessage(a)},
g.prototype.dispatchMessage=function(a){var c=this;a.type.equals(b.messages.AsyncResultType)?a.body.isSuccess?this.sendQueue.resolveAsync(a.body.sequence):this.sendQueue.rejectAsync(a.body.sequence,a.body.error):Promise.resolve(a).then(function(a){return c.dispatchEvent(h.MESSAGE_RECEIVED,a)})},g.prototype.relayEvents=function(a,b){var c=this;a.addEventListener(b,function(a){c.dispatchEvent(b,a)})},g.prototype.fatalError=function(a,b){c.error(a,b);this.dispatchEvent(h.FATAL_ERROR,{message:a})},g}(a.util.events.EventTarget),
k=function(b){function c(d,e,f){b.call(this,d,new a.connection.nouns.ReconnectSession,a.connection.Method.GET,null,e.sessionKey,{"ReconnectSession.offset":f.toString(10)})}return B(c,b),c}(a.connection.requests.NounRequest)}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(b){!function(b){var c=function(a){function b(){a.call(this,null,"AsyncResult")}return B(b,a),b}(a.connection.MessageType);b.AsyncResultType=new c}(b.messages||(b.messages={}))}(a.connection||(a.connection={}))}(m||
(m={}));!function(a){!function(a){!function(a){var b=function(){return function(){this.nounPrefix="System";this.nounName="Messages";this.properties=null}}();a.Messages=b}(a.nouns||(a.nouns={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){!function(a){var b=function(){return function(){this.nounPrefix="System";this.nounName="MultiNoun";this.properties=new e}}();a.MultiNoun=b;var e=function(){return function(){}}();a.MultiNounProperties=e;b=function(){return function(){}}();
a.MultiNounPropertiesNounWrapper=b}(a.nouns||(a.nouns={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){!function(a){var b=function(){return function(){this.nounPrefix="System";this.nounName="ReconnectSession";this.properties=null}}();a.ReconnectSession=b}(a.nouns||(a.nouns={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){!function(a){var b=function(){return function(){this.nounPrefix="System";this.nounName="SessionId";this.properties=null}}();
a.SessionId=b}(a.nouns||(a.nouns={}))}(a.connection||(a.connection={}))}(m||(m={}));!function(a){!function(a){!function(a){var b=function(){return function(){this.nounPrefix="System";this.nounName="UiMetrics";this.properties=new e}}();a.UiMetrics=b;var e=function(){return function(){this.counters=[];this.histograms=[];this.gauges=[]}}();a.UiMetricsProperties=e;b=function(){return function(){}}();a.UiMetricsCounter=b;b=function(){return function(){}}();a.UiMetricsGauge=b;b=function(){return function(){}}();
a.UiMetricsHistogram=b}(a.nouns||(a.nouns={}))}(a.connection||(a.connection={}))}(m||(m={}));var B=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},w,ea=new (function(){return function(){this.pollTimeout=4E4}}()),l={connection:{getNounPrefix:function(){return""},setEndpoint:function(a,b,d){w||(m.connection.isInitialized()||m.connection.initialize(a,b,d),w=m.connection.getConnection(),
Oa(w))},start:function(a){var b=this;w.start(a).then(function(a){return b.onInit()},function(a){return b.onError(a)})},restart:function(){w.restart(ea.sessionId,ea.sessionKey,ea.affinityToken,ea.pollTimeout);this.onInit()},stop:function(){if(null!=w){w.stop();var a=w;a.removeEventListeners("legacy-connection-fatal-error");a.removeEventListeners("legacy-connection-message-received");a.removeEventListeners("legacy-connection-reconnecting");a.removeEventListeners("legacy-connection-reconnected");a.removeEventListeners("legacy-connection-reinit");
a.removeEventListeners("legacy-connection-longpoll-completed");w=null}},createCallbackHandler:function(){return qa()},send:function(a,b,d){var c=qa();if(!w)return c.callback(!1,"realConnection is null");w.send({nounPrefix:this.getNounPrefix(),nounName:a,properties:b,sensitiveProperties:d}).then(function(a){return c.callback(!0,a)})["catch"](function(a){return c.callback(!1,a)});return c},setConnectionTimeout:function(a){w.setConnectionTimeout(a)},sendWithPrefix:function(a,b,d,c){var e=qa();w.send({nounPrefix:a,
nounName:b,properties:d}).then(function(a){return e.callback(!0,a)})["catch"](function(a){c?c.call(window):null;e.callback(!1,a)});return e},setSessionId:function(a){ea.sessionId=a},setSessionKey:function(a){ea.sessionKey=a},setAffinityToken:function(a){ea.affinityToken=a},isRunning:function(){return w&&w.isRunning()},getSessionId:function(){return w&&w.getSessionId()},getSessionKey:function(){return w&&w.getSessionKey()},getAffinityToken:function(){return w&&w.getAffinityToken()},serialize:function(){return JSON.parse(w.serialize())},
deserialize:function(a){w=m.connection.deserialize(JSON.stringify(a));Oa(w)},abortConnection:function(){return w&&w.abort()},onError:function(a){return null},onInit:function(){return null},onReInit:function(){return null},onLongPoll:function(){return null},messageHandler:function(a,b){return null},onReconnect:function(a){return null},reinitializeSession:function(){return null},enableOutboundMessage:function(){return null}},createCallbackHandler:function(){return qa()},doRequest:function(a,b,d,c,e,
f,h){var g="";c&&(g=h?h:l.connection.getNounPrefix(),g+="/");var k=qa();w.getMessenger().send(new $a(g+a,w.getApiVersion(),e,b),d).then(function(a){f&&k.callback(!0,a.getData())},function(a){return k.callback(!1,{data:a.data,status:a.status})});return k}},$a=function(a){function b(b,c,e,f){a.call(this,c,m.connection.Method.GET,f);this.data=null;this.url=b;e&&(this.data=JSON.stringify(e))}B(b,a);b.prototype.getBaseUrl=function(){return this.url};b.prototype.getBody=function(){return this.data};return b}(m.connection.Request),
H={getCookie:function(a){var b=document.cookie,d=b.indexOf(a+"\x3d");if(-1==d)return null;d+=(a+"\x3d").length;a=b.indexOf(";",d);-1==a&&(a=b.length);return b.substring(d,a)},setCookie:function(a,b,d){a=a+"\x3d"+b+";";void 0===settings.optionalCookieEnabled&&(settings.optionalCookieEnabled=!0);settings.secureCookiesEnabled=void 0!==settings.secureCookiesEnabled?settings.secureCookiesEnabled:!1;0===a.indexOf("liveagent_invite_rejected_")||settings.optionalCookieEnabled?d&&(d=new Date,d.setFullYear(d.getFullYear()+
1),a+="expires\x3d"+d.toGMTString()+";"):(d=new Date,d.setFullYear(d.getFullYear()-1),a+="expires\x3d"+d.toGMTString()+";");a=a+"path\x3d/;"+(settings.secureCookiesEnabled?"secure":"");document.cookie=a},addEventListener:function(a,b,d){if(a.addEventListener)a.addEventListener(b,d,!1);else if(a.attachEvent)a.attachEvent("on"+b,d,!1);else throw Error("Could not add event listener");},log:function(a){loggingEnabled&&window.console&&window.console.log&&window.console.log("LIVE AGENT: "+a)},logGroupStart:function(a){loggingEnabled&&
window.console&&(window.console.group?window.console.groupCollapsed("LIVE AGENT: "+a):H.log(a))},logGroupEnd:function(){loggingEnabled&&window.console&&window.console.group&&window.console.groupEnd()},getLanguage:function(){return"undefined"!=typeof window.navigator.language?window.navigator.language:"undefined"!=typeof window.navigator.userLanguage?window.navigator.userLanguage:""},arrayHasItem:function(a,b){if(Array.prototype.indexOf)return-1<a.indexOf(b);for(var d=0;d<a.length;d++)if(a[d]==b)return!0},
jsonEncode:function(a,b,d){function c(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,b){var d,f,g,h,r=k,q,p=b[a];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(a));"function"===typeof m&&(p=m.call(b,a,p));switch(typeof p){case "string":return c(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);case "object":if(!p)return"null";
k+=l;q=[];if("[object Array]"===Object.prototype.toString.apply(p)){h=p.length;for(d=0;d<h;d+=1)q[d]=e(d,p)||"null";g=0===q.length?"[]":k?"[\n"+k+q.join(",\n"+k)+"\n"+r+"]":"["+q.join(",")+"]";k=r;return g}if(m&&"object"===typeof m)for(h=m.length,d=0;d<h;d+=1)"string"===typeof m[d]&&(f=m[d],(g=e(f,p))&&q.push(c(f)+(k?": ":":")+g));else for(f in p)Object.prototype.hasOwnProperty.call(Object(p),f)&&(g=e(f,p))&&q.push(c(f)+(k?": ":":")+g);g=0===q.length?"{}":k?"{\n"+k+q.join(",\n"+k)+"\n"+r+"}":"{"+
q.join(",")+"}";k=r;return g}}if("undefined"!==typeof window.JSON)return window.JSON.stringify(a,b,d);if(void 0===a||null===a)return"null";var f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g,k="",l="",m=b;if("number"===typeof d)for(g=0;g<d;g+=1)l+=" ";else"string"===typeof d&&(l=d);if(b&&"function"!==typeof b&&("object"!==typeof b||"number"!==
typeof b.length))throw Error("Error during JSON.stringify");return e("",{"":a})},jsonDecode:function(a){a=String(a);if("undefined"!==typeof window.JSON)return window.JSON.parse(a);var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+a+")");throw Error("Error during JSON.parse");},getCssAnimation:function(a){var b=["Webkit","Moz","O","ms","Khtml"];if(void 0!==a.style.animationName)return"";for(var d=0;d<b.length;d++)if(void 0!==a.style[b[d]+"AnimationName"])return b[d].toLowerCase();return null},addPrefixToURL:function(a,b,d){if(!H.isEmpty(a)&&!H.isEmpty(b)&&0!==a.indexOf(b)){d&&(b=H.escapeToHtml(b));var c=/(https?:\/\/)(.*)/i;d=a.replace(c,"$1");a=a.replace(c,"$2");b=b.replace(c,
"$2");a=d+b+"/"+a}return a},getDomainFromUrl:function(a){if(H.isEmpty(a))return"";var b;Na||(Na=document.createElement("a"));b=Na;b.href=a;a=a.match(/:(\d+)/g);b=b.protocol+"//"+b.hostname||window.location.protocol+"//"+window.location.hostname;return a?b+a[0]:b},isEmpty:function(a){return null===a||void 0===a||""===a},escapeToHtml:function(a){return null===a||void 0===a||""===a?"":a=a.replace(/[&<>"'\u00a9\u2028\u2029]/g,Ya)},isValidEntityId:function(a){return a&&"string"===typeof a&&(18===a.length||
15===a.length)},getKeyPrefix:function(a){return this.isValidEntityId(a)?a.substr(0,3):null},isOrganizationId:function(a){return"00D"===this.getKeyPrefix(a)},isDeploymentId:function(a){return"572"===this.getKeyPrefix(a)},trim:function(a){return a&&a.replace(/^[\s\u0000-\u0020]*|[\s\u0000-\u0020]*$/g,"")||""}},Na,K={AGENT:"agent",CHASITOR:"client",ERROR:"error",CHASITOR_IDLE_TIMEOUT:"clientIdleTimeout",AGENT_PUSH_TIMEOUT:"agentPushTimeout",AGENTS_UNAVAILABLE:"agentsUnavailable",CHATBOT_ENDED_CHAT:"chatbotEndedChat"},
D={richResponse:{actions:[{type:"",index:"",dialogId:"",value:""}]},clickRichItemResponse:function(a,b,d,c,e){b.actions[0].type=e;b.actions[0].dialogId=null;b.actions[0].value=null;b.actions[0].index=parseInt(a.getAttribute("data-index"));a.getAttribute("data-dialogid")&&(b.actions[0].dialogId=a.getAttribute("data-dialogid"));a.getAttribute("data-value")&&(b.actions[0].value=a.getAttribute("data-value"));this.clearRichElements();d.sendRichMessage(b).complete(function(){c.stop()})},clickSnapInRichItemResponse:function(a,
b,d,c){d.sendRichMessage(a).complete(function(){c.stop()})},moveButtons:function(a,b){newLeft=parseInt(window.getComputedStyle(a,null).getPropertyValue("left"),10)+b;a.style.left=newLeft+"px"},sanitizeText:function(a){return 40<a.length?a.substring(0,40).concat("..."):a},hideFooterMenu:function(){document.getElementById("footerMenuContainer")&&(document.getElementById("footerMenuContainer").style.display="none")},toggleFooterMenu:function(){var a=document.getElementById("footerMenuContainer");a.style.display=
"none"==a.style.display?"block":"none"},findAncestor:function(a,b){for(;(a=a.parentElement)&&!a.classList.contains(b););return a},removeElementFromDom:function(a){document.getElementById(a)&&(a=document.getElementById(a),a.parentNode.removeChild(a))},removeFooterMenu:function(){var a=document.getElementById("chatInput");this.removeElementFromDom("footerMenuContainer");this.removeElementFromDom("triggerFooterMenu");a&&(a.style.marginLeft="0px")},clearRichElements:function(){this.removeElementFromDom("richMenuWrapper");
this.removeElementFromDom("buttonWrapper")}},G={log:function(a){window&&window.console&&window.console.log(a)},logGroupStart:function(a){window.console.group?window.console.groupCollapsed("LIVE AGENT: "+a):G.log("LIVE AGENT: "+a)},logGroupEnd:function(){window.console&&window.console.group&&window.console.groupEnd()},error:function(a){window&&window.console&&window.console.error?a.stack&&window.console.log?a.stack?(G.logGroupStart("Error: "+a),window.console.log("Stacktrace: "),window.console.log(a.stack),
G.logGroupEnd()):window.console.error(a):window.console.error(a):G.log(a)},forEachMapped:function(a,b){for(var d in a)a.hasOwnProperty(d)&&b.call(window,a[d],d)},finalizeObject:function(a){var b={};if(Object.defineProperty){for(var d in a)if(a.hasOwnProperty(d))try{Object.defineProperty(b,d,{value:a[d],writable:!1,enumerable:!0,configurable:!1})}catch(c){return!1}return b}return!1},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)}},ta=!1,J=null,S=null,T=null,ja=null,ua=!1,Ea=null,
va=null,Fa=null,Ga=null,Ha=null,Ia="",wa=!1,ka="",la="",xa="",ya=null,za=!1,Aa=!1,C=[],Z=null,fa=null,P="",U="",Y=!1,ha=!1,O=null,Ja=null,Ka=null,I=null,Q=null,E=[],Ba=[],ia=null,A=null,L=[],ma=null,M=!1,La=!1,da=null,na=[],R=!1,ga=!1,oa=!1,z=!1,Ua=!1,Ma=!1,F=!1,aa=!1,V=!1,ba=!1,ca=!1,Va="/content/images/avatar-bot.png",p=function(){try{window.liveagent.chasitor.onMutate()}catch(a){G.log("Error calling onMutate: "+a)}};l.onMutate=p;var W=!1,r={CONNECTION_ERROR:"chasitorConnectionError",RECONNECTING:"chasitorReconnecting",
CHAT_REQUEST_SUCCESSFUL:"chasitorChatRequestSuccessful",CHAT_REQUEST_FAILED:"chasitorChatRequestFailed",CHAT_ESTABLISHED:"chasitorChatEstablished",QUEUE_UPDATE:"chasitorQueueUpdate",ESTIMATED_WAIT_TIME:"chasitorEstimatedWaitTime",POST_CHAT:"postChat",AGENT_DISCONNECTED:"chasitorAgentDisconnected",AGENT_CHAT_MESSAGE:"chasitorAgentChatMessage",AGENT_CHAT_ENDED:"chasitorAgentChatEnded",AGENT_CHAT_TRANSFERRED:"chasitorAgentChatTransferred",BOT_CHAT_TRANSFERRED:"chasitorBotChatTransferred",AGENT_TYPING_UPDATE:"chasitorAgentTypingUpdate",
CHASITOR_CHAT_MESSAGE:"chasitorChasitorChatMessage",AGENT_RICH_MESSAGE:"agentRichMessage",CHASITOR_CHAT_ENDED:"chasitorChasitorChatEnded",CHASITOR_CHAT_CANCELED:"chasitorChasitorChatCanceled",DEPLOYMENT_SETTINGS:"deploymentSettings",FILE_TRANSFER_REQUESTED:"fileTransferRequested",FILE_TRANSFER_CANCELED:"fileTransferCanceled",FILE_TRANSFER_SUCCESS:"fileTransferSuccess",FILE_TRANSFER_FAILURE:"fileTransferFailure",AGENT_CHAT_TRANSFER_TO_BUTTON_INITIATED:"transferToButtonInitiated",AGENT_CHAT_TRANSFER_TO_SBR_SKILL_INITIATED:"transferToSbrSkillInitiated",
AGENT_CHAT_TRANSFER_TO_QUEUE_INITIATED:"transferToQueueInitiated",AGENT_CHAT_TRANSFER_TO_BOT_INITIATED:"transferToBotInitiated",AGENT_JOINED_CONFERENCE:"chasitorAgentJoinedConference",AGENT_LEFT_CONFERENCE:"chasitorAgentLeftConference",START_CHASITOR_IDLE_TIMEOUT_WARNING:"startChasitorIdleWarning",UPDATE_CHASITOR_IDLE_TIMEOUT_WARNING:"updateChasitorIdleWarning",CHASITOR_IDLE_TIMEOUT:"chasitorIdleTimeout",CLEAR_CHASITOR_IDLE_TIMEOUT:"clearChasitorIdleTimeout",CHAT_RESUMED_AFTER_TRANSFER:"chatResumedAfterTransfer",
CHATBOT_ENDED_CHAT:"chatbotEndedChat"},Wa={UNAVAILABLE:"Unavailable",INTERNAL_FAILURE:"InternalFailure",NO_POST:"NoPost",BLOCKED:"Blocked"};l.connection.getNounPrefix=function(a){return"Chasitor"};var pa={_messageQueue:[],_timeoutSet:!1,scheduleMessage:function(a){null==a.schedule||null==a.schedule.responseDelayMilliseconds||0==a.schedule.responseDelayMilliseconds?pa._postMessage(a):pa._enqueue(a)},_queueChecker:function(){if(!F){var a=this._messageQueue.shift();void 0!==a&&(this._postMessage(a),
0===this._messageQueue.length?this._timeoutSet=!1:(this._timeoutSet=!0,a=parseInt(this._messageQueue[0].schedule.responseDelayMilliseconds,10),setTimeout(function(){pa._queueChecker()},a)))}},_enqueue:function(a){this._messageQueue.push(a);this._schedule()},_schedule:function(){if(!this._timeoutSet){this._timeoutSet=!0;var a=parseInt(this._messageQueue[0].schedule.responseDelayMilliseconds,10);setTimeout(function(){pa._queueChecker()},a)}},_postMessage:function(a){void 0===a.type?this._postPlainMessage(a):
this._postRichMessage(a)},_postPlainMessage:function(a){a=new v(v.TYPE.AGENT,a.text,a.name,a.agentId);E.push(a);p();D.clearRichElements();q(r.AGENT_CHAT_MESSAGE,a.getPublicInterface())},_postRichMessage:function(a){a.isOptionClicked=!1;0<a.items.length&&E.push(new v(v.TYPE.AGENT,a,a.name,a.agentId));p();q(r.AGENT_RICH_MESSAGE,a)}};l.connection.messageHandler=function(a,b){function d(a){for(var b=window.location.search.substring(1).split("\x26"),c=0;c<b.length;c++){var d=b[c].split("\x3d");if(d[0]===
a)return d[1]}}function c(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)"chatbot_avatar_image"==a[b].label&&(Va=a[b].value)}switch(a){case l.ChasitorMessage.CHAT_REQUEST_SUCCESS:ga=!0;z=!1;Q=b.queuePosition;ya=b.geoLocation;la=b.url;xa=b.oref;I=b.postChatUrl;A.geoLocation=b.geoLocation;A.visitorId=b.visitorId;A.customDetails=b.customDetails;c(b.customDetails);b.sensitiveDataRules.forEach(function(a){na.push(new Ca(a.id,a.name,a.pattern,a.actionType,a.replacement))});null!=b.transcriptSaveEnabled&&
(wa=b.transcriptSaveEnabled);p();q(r.CHAT_REQUEST_SUCCESSFUL,Q);G.log("Chat Request Success : Queue Position "+Q);b.estimatedWaitTime&&(G.log("Chat Request Success : Estimated Wait Time "+b.estimatedWaitTime),q(r.ESTIMATED_WAIT_TIME,b.estimatedWaitTime));null!=b.connectionTimeout&&l.connection.setConnectionTimeout(b.connectionTimeout);break;case l.ChasitorMessage.CHAT_REQUEST_FAIL:ga=!1;oa=!0;z=!1;l.connection.stop();I=b.postChatUrl;p();q(r.CHAT_REQUEST_FAILED,b.reason);if(b.reason!==Wa.NO_POST&&
I){var e=new sa(K.ERROR,I,b.attachedRecords,b.reason);q(r.POST_CHAT,e.getPublicInterface())}break;case l.ChasitorMessage.CHASITOR_SESSION_DATA:l.connection.enableOutboundMessage();ga=!0;oa=!1;z=!0;Q=b.queuePosition;ya=b.geoLocation;la=b.url;xa=b.oref;I=b.postChatUrl;W=b.sneakPeekEnabled;p();q(r.RECONNECTING,!0);G.log("Finished Resyncing Chasitor State");G.log("Queue Position "+Q);break;case l.ChasitorMessage.QUEUE_UPDATE:Q=b.position;p();q(r.QUEUE_UPDATE,Q);G.log("Queue Update : Queue Position      : "+
Q);b.estimatedWaitTime&&(G.log("Queue Update : Estimated wait time : "+b.estimatedWaitTime),q(r.ESTIMATED_WAIT_TIME,b.estimatedWaitTime));break;case l.ChasitorMessage.CHAT_ESTABLISHED:z=!0;ca=ba=V=!1;Ka=(new Date).getTime();W=b.sneakPeekEnabled;x.init(b.chasitorIdleTimeout.isEnabled,b.chasitorIdleTimeout.warningTime,b.chasitorIdleTimeout.timeout);A.agent={};A.agent.userId=b.userId;A.agent.agentName=b.name;A.agent.transfer=0;p();q(r.CHAT_ESTABLISHED,b);break;case l.ChasitorMessage.CHAT_MESSAGE:x.start();
pa.scheduleMessage(b);break;case l.ChasitorMessage.AGENT_TYPING:aa=!0;p();q(r.AGENT_TYPING_UPDATE,{isAgentTyping:aa,name:b.name,agentId:b.agentId});break;case l.ChasitorMessage.AGENT_NOT_TYPING:aa=!1;p();q(r.AGENT_TYPING_UPDATE,{isAgentTyping:aa,name:b.name,agentId:b.agentId});break;case l.ChasitorMessage.CHAT_TRANSFERRED:z=!0;ca=ba=V=!1;W=b.sneakPeekEnabled;e=A.agent.transfer;A.agent={};A.agent.userId=b.userId;A.agent.agentName=b.name;A.agent.transfer=e+1;p();x.init(b.chasitorIdleTimeout.isEnabled,
b.chasitorIdleTimeout.warningTime,b.chasitorIdleTimeout.timeout);e=new v(v.TYPE.SYSTEM.TRANSFERRED,"",b.name);E.push(e);D.removeFooterMenu();b.isTransferToBot?q(r.BOT_CHAT_TRANSFERRED,e.getPublicInterface()):q(r.AGENT_CHAT_TRANSFERRED,e.getPublicInterface());break;case l.ChasitorMessage.CHAT_ENDED:F||(F=!0,l.connection.stop(),x.stop(),p());if(I)q(r.POST_CHAT,(new sa(b.reason,I,b.attachedRecords)).getPublicInterface());else if(b.reason===K.CHATBOT_ENDED_CHAT)q(r.CHATBOT_ENDED_CHAT,b);else if(b.reason!=
K.CHASITOR_IDLE_TIMEOUT){a:switch(b.reason){case K.AGENT:case K.AGENT_PUSH_TIMEOUT:e=!0;break a;default:e=!1}q(e?r.AGENT_CHAT_ENDED:r.CHASITOR_CHAT_ENDED,b.reason)}break;case l.ChasitorMessage.AGENT_DISCONNECT:z&&(z=!1,p(),q(r.AGENT_DISCONNECTED),x.stop());break;case l.ChasitorMessage.NEW_VISITOR_BREADCRUMB:la=b.location;p();break;case l.ChasitorMessage.CUSTOM_EVENT:e=new Ta("Agent",b.type,b.data);Ba.push(e);q("customEvent_"+b.type,e);break;case l.ChasitorMessage.FILE_TRANSFER:switch(b.type){case "Requested":M=
!0;p();var e={},f=b.uploadServletUrl,h=b.cdmServletUrl,g=d("proxy");if(!H.isEmpty(g))var g=H.escapeToHtml(g),k=H.addPrefixToURL(H.getDomainFromUrl(h),g),f=H.addPrefixToURL(f,g),h=H.addPrefixToURL(h,g)+"?fullProxy\x3d"+k+"\x26proxy\x3d"+g;e.uploadServletUrl=f;e.cdmServletUrl=h;e.fileToken=b.fileToken;q(r.FILE_TRANSFER_REQUESTED,e);x.reset();break;case "Canceled":M=!1;p();q(r.FILE_TRANSFER_CANCELED);x.reset();break;case "Success":M=!1;p();q(r.FILE_TRANSFER_SUCCESS);break;case "Failure":M=!1,p(),q(r.FILE_TRANSFER_FAILURE)}break;
case l.ChasitorMessage.TRANSFER_TO_SBR_SKILL_INITIATED:z=!1;ba=!0;x.stop();p();q(r.AGENT_CHAT_TRANSFER_TO_SBR_SKILL_INITIATED);break;case l.ChasitorMessage.TRANSFER_TO_BOT_INITIATED:z=!1;ca=!0;x.stop();p();q(r.AGENT_CHAT_TRANSFER_TO_BOT_INITIATED);break;case l.ChasitorMessage.TRANSFER_TO_QUEUE_INITIATED:z=!1;V=!0;x.stop();p();q(r.AGENT_CHAT_TRANSFER_TO_QUEUE_INITIATED);break;case l.ChasitorMessage.TRANSFER_TO_BUTTON_INITIATED:z=!1;V=!0;x.stop();p();q(r.AGENT_CHAT_TRANSFER_TO_BUTTON_INITIATED);break;
case l.ChasitorMessage.AGENT_JOINED_CONFERENCE:e=new v(v.TYPE.SYSTEM.AGENT_JOINED_CONFERENCE,"",b.name);E.push(e);q(r.AGENT_JOINED_CONFERENCE,{name:b.name,agentId:b.agentId});break;case l.ChasitorMessage.AGENT_LEFT_CONFERENCE:e=new v(v.TYPE.SYSTEM.AGENT_LEFT_CONFERENCE,"",b.name);E.push(e);q(r.AGENT_LEFT_CONFERENCE,{name:b.name,agentId:b.agentId});break;case l.ChasitorMessage.RICH_MESSAGE:x.start();pa.scheduleMessage(b);break;case l.ChasitorMessage.CHAT_RESUMED_AFTER_TRANSFER:z=!0,p()}};v.prototype=
new ra;v.TYPE={AGENT:"agent",CHASITOR:"chasitor",SYSTEM:{ENDED_AGENT:"endedAgent",ENDED_CHASITOR:"endedChasitor",RECONNECTED:"reconnected",TRANSFERRED:"transferred",CANCELED_CHASITOR:"canceledChasitor",CHASITOR_IDLE_TIMEOUT:"chasitorIdleTimeout",AGENT_JOINED_CONFERENCE:"agentJoinedConference",AGENT_LEFT_CONFERENCE:"agentLeftConference"}};Pa.prototype=new ra;Qa.prototype=new ra;sa.prototype=new ra;sa.TYPE={ENDED_AGENT:"agent",ENDED_CHASITOR:"client",ENDED_ERROR:"error"};Ca.ACTION_TYPE={REMOVE:"Remove",
REPLACE:"Replace"};var y={};(function(){l.ChasitorMessage={AGENT_DISCONNECT:"AgentDisconnect",AGENT_JOINED_CONFERENCE:"AgentJoinedConference",AGENT_LEFT_CONFERENCE:"AgentLeftConference",AGENT_NOT_TYPING:"AgentNotTyping",AGENT_TYPING:"AgentTyping",CHASITOR_SESSION_DATA:"ChasitorSessionData",CHAT_ENDED:"ChatEnded",CHAT_ESTABLISHED:"ChatEstablished",CHAT_MESSAGE:"ChatMessage",CHAT_REQUEST_FAIL:"ChatRequestFail",CHAT_REQUEST_SUCCESS:"ChatRequestSuccess",CHAT_RESUMED_AFTER_TRANSFER:"ChatResumedAfterTransfer",
CHAT_TRANSFERRED:"ChatTransferred",CUSTOM_EVENT:"CustomEvent",FILE_TRANSFER:"FileTransfer",NEW_VISITOR_BREADCRUMB:"NewVisitorBreadcrumb",QUEUE_UPDATE:"QueueUpdate",RICH_MESSAGE:"RichMessage",TRANSFER_TO_BOT_INITIATED:"TransferToBotInitiated",TRANSFER_TO_BUTTON_INITIATED:"TransferToButtonInitiated",TRANSFER_TO_QUEUE_INITIATED:"TransferToQueueInitiated",TRANSFER_TO_SBR_SKILL_INITIATED:"TransferToSbrSkillInitiated"};var a=l.connection;y={init:function(b){Fa=a.getSessionId();for(var d=[],c=0;c<C.length;c++){var e=
{};e.label=C[c].getPublicInterface().getLabel();e.value=C[c].getPublicInterface().getValue();e.entityMaps=C[c].getPublicInterface().getEntityMaps();e.transcriptFields=C[c].getPublicInterface().getTranscriptFields();e.displayToAgent=C[c].getPublicInterface().getDisplayToAgent();e.doKnowledgeSearch=C[c].getPublicInterface().getDoKnowledgeSearch();d.push(e)}A={};A.prechatDetails=d;for(var f=[],c=0;c<L.length;c++)e={},e.entityName=L[c].getPublicInterface().getEntityName(),e.showOnCreate=L[c].getPublicInterface().getShowOnCreate(),
e.linkToEntityName=L[c].getPublicInterface().getLinkToEntityName(),e.linkToEntityField=L[c].getPublicInterface().getLinkToEntityField(),e.saveToTranscript=L[c].getPublicInterface().getSaveToTranscript(),e.entityFieldsMaps=L[c].getPublicInterface().getEntityFieldsMaps(),f.push(e);b={organizationId:J,deploymentId:S,buttonId:T,sessionId:Ea,trackingId:va,userAgent:window.navigator.userAgent,language:ka,screenResolution:screen.width+"x"+screen.height,visitorName:fa,prechatDetails:d,buttonOverrides:b,receiveQueueUpdates:Aa,
prechatEntities:f,isPost:za};null!==ma&&(b.visitorInfo=ma);null!==ja&&(b.agentId=ja,b.doFallback=ua);p();return a.send("ChasitorInit",b)},resyncState:function(){var a={organizationId:J},d=l.connection.getSessionId(),c=l.connection.getSessionKey(),e=l.connection.getAffinityToken();p();return l.doRequest("ChasitorResyncState/"+d,c,e,!0,a,!1)},sendMessage:function(b){D.clearRichElements();return a.send("ChatMessage",{text:b})},sendRichMessage:function(b){D.clearRichElements();return a.send("RichMessage",
b)},sendSneakPeek:function(b,d){return a.send("ChasitorSneakPeek",{position:b,text:d})},sendTypingUpdate:function(b){return a.send(b?"ChasitorTyping":"ChasitorNotTyping",{})},endChat:function(){return a.send("ChatEnd",{reason:K.CHASITOR})},sendCustomEvent:function(b,d){Ba.push(new Ta("Chasitor",b,d));return a.send("CustomEvent",{type:b,data:d})},cancelFileTransfer:function(){return a.send("FileTransferCancellation",{})},cancelChat:function(){return a.send("ChatCancel",{})},sendSensitiveDataRuleTriggered:function(b){for(var d=
[],c=0;c<b.length;c++)d.push({id:b[c].getId(),name:b[c].getName()});return a.send("SensitiveDataRuleTriggered",{rules:d})},sendChasitorIdleTimeout:function(){return a.send("ChatEnd",{reason:K.CHASITOR_IDLE_TIMEOUT})},sendChasitorIdleTimeoutWarningEvent:function(b){return a.send("ChasitorIdleTimeoutWarningEvent",{idleTimeoutWarningEvent:b})},sendChatVisibilityChange:function(b){return a.send("ChatVisibilityChange",{isHidden:b})}}})();Sa.prototype=new ra;var x=(new Sa).getPublicInterface();window.liveagent||
(window.liveagent={},Xa(window.liveagent));window.liveagent.isRunning=function(){return l.connection.isRunning()};window.liveagent.chasitor={Events:r,ChatRequestFailureReason:Wa,ChatMessageType:v.TYPE,PostChatEventType:sa.TYPE,ChatEndReason:K,init:function(a,b,d,c){if(ta)throw Error("You cannot connect to an already initialized connection");ta=!0;ia=b;l.connection.setEndpoint(a,b,55);"undefined"===typeof c&&(c=!0);var e={};a=document.location.hash.toString();"#"==a.charAt(0)&&(a=a.substr(1),a.split("\x26").forEach(function(a){a=
a.split("\x3d");e[a[0]]=a[1]}),J=null!==J?J:e.org_id,S=null!==S?S:e.deployment_id,T=null!==T?T:e.button_id,e.hasOwnProperty("agent_id")&&(ja=e.agent_id,ua=e.hasOwnProperty("do_fallback")));if(!J)throw Error("Organization ID must be set!");if(!S)throw Error("Deployment must be set!");if(!T)throw Error("Button must be set!");Ea=e.session_id&&"null"!=e.session_id?e.session_id:null;va=e.tracking_id?e.tracking_id:"";"undefined"!=typeof window.navigator.language?ka=window.navigator.language:"undefined"!=
typeof window.navigator.userLanguage&&(ka=window.navigator.userLanguage);c&&(window.addEventListener?window.addEventListener("beforeunload",function(){l.connection.stop(!1)},!1):window.attachEvent("onbeforeunload",function(){l.connection.stop(!1)},!1));var f,h;"undefined"!==typeof document.hidden?(f="hidden",h="visibilitychange"):"undefined"!==typeof document.mozHidden?(f="mozHidden",h="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(f="msHidden",h="msvisibilitychange"):"undefined"!==
typeof document.webkitHidden&&(f="webkitHidden",h="webkitvisibilitychange");document.addEventListener(h,function(){z&&!F&&(document[f]?y.sendChatVisibilityChange(!0):y.sendChatVisibilityChange(!1))},!1);this.onMutate();l.connection.onInit=function(){y.init(d)};l.connection.onLongPoll=function(){p()};l.connection.onReInit=function(){F||oa||(aa=ga=z=!1,y.init(d),p())};l.connection.onError=function(a){q(r.CONNECTION_ERROR,a);p()};l.connection.onReconnect=function(a){var b=!0;p();a?(Ma&&(z=Ua),Ma=!1,
x.resume()):(Ma?b=!1:Ua=z,Ma=!0,z=!1,x.pause());b&&q(r.RECONNECTING,a)};l.connection.onResyncState=function(){q(r.RECONNECTING,!1);y.resyncState().error(function(){G.log("Chasitor ResyncState Error. Request new chat.");l.connection.onReinit()});p()};l.connection.onSwitchServer=function(a,b){q(r.CONNECTION_ERROR,Error("Incorrect endpoint used. Expected: "+a+" Actual: "+b))}},addEventListener:window.liveagent.addEventListener,resetChasitorState:function(){ta=!1;ja=T=S=J=null;ua=!1;Ha=Ga=Fa=va=Ea=null;
Ia="";wa=!1;xa=la=ka="";ya=null;Aa=za=!1;C=[];fa=Z=null;U=P="";ha=Y=!1;Q=I=Ka=Ja=O=null;E=[];Ba=[];A=ia=null;L=[];La=M=!1;da=null;na=[];W=ba=ca=V=aa=F=z=oa=ga=R=!1;this.onMutate()},serialize:function(){for(var a=l.connection.serialize(),b=this.getChatMessages(),d=[],c=0;c<b.length;c++){var e={};e.type=b[c].getType();e.name=b[c].getName();e.content=b[c].getContent();e.userId=b[c].getUserId();e.timestamp=b[c].getTimestamp();e.date=b[c].getDate();d.push(e)}var f=[];na.forEach(function(a){var b={};b.id=
a.getId();b.name=a.getName();b.pattern=a.getPattern();b.actionType=a.getActionType();b.replacement=a.getReplacement();f.push(b)});b=x.getTimeoutData();d={initialized:ta,organizationId:this.getOrgId(),deploymentId:this.getDeploymentId(),buttonId:this.getButtonId(),agentId:ja,doFallback:ua,sessionId:this.getConnectionSessionId(),trackingId:va,chatKey:this.getChatKey(),brandingImage:this.getBrandingImage(),mobileBrandingImage:this.getMobileBrandingImage(),windowTitle:this.getWindowTitle(),transcriptSaveEnabled:this.getTranscriptSaveEnabled(),
language:this.getLanguage(),lastUrl:this.getLastUrl(),oref:void 0==this.getOref()?"":this.getOref(),geoLocation:this.getGeoLocation(),isPost:za,receiveQueueUpdates:Aa,localName:Z,name:void 0==fa?null:fa,heldSneakPeek:P,lastSneakPeek:U,heldIsTyping:Y,lastIsTyping:ha,sneakPeekTimeout:O,requestTime:this.getRequestTime(),acceptTime:this.getAcceptTime(),postChatUrl:void 0==this.getPostChatUrl()?"":this.getPostChatUrl(),queuePosition:this.getQueuePosition(),chatMessages:d,customEvents:[],prechatEntities:[],
prechatData:[],sensitiveDataRules:f,contentServerUrl:ia,contentEndpoint:this.getContentEndpoint(),detailsInfo:this.getDetails(),isFileRequested:M,dispQueuePosition:this.getDispQueuePosition(),clientType:this.getClientType(),isChatRequested:R,isChatRequestSuccessful:this.isChatRequestSuccessful(),isChatRequestFailed:this.isChatRequestFailed(),isChatEstablished:this.isChatEstablished(),isChatEnded:this.isChatEnded(),isAgentTyping:this.isAgentTyping(),isChatTransferredToQueue:this.isChatTransferredToQueue(),
isChatTransferredToSbrSkill:this.isChatTransferredToSbrSkill(),isChatTransferredToBot:this.isChatTransferredToBot(),isSneakPeekEnabled:this.isSneakPeekEnabled(),idleTimeoutEnabled:b.enabled,idleTimeoutWarningInSeconds:b.warningInSeconds,idleTimeoutTimeoutInSeconds:b.timeoutInSeconds,idleTimeoutIsRunning:b.isRunning,visitorInfo:ma};return JSON.stringify({connectionData:a,chasitorData:d})},deserialize:function(a){var b=JSON.parse(a);a=b.chasitorData;l.connection.deserialize(b.connectionData);E=[];for(var b=
a.chatMessages,d=0;d<b.length;d++){var c=new v(b[d].type,b[d].content,b[d].name,b[d].userId,b[d].timestamp,b[d].date);E.push(c)}na=[];a.sensitiveDataRules.forEach(function(a){a=new Ca(a.id,a.name,a.pattern,a.actionType,a.replacement);na.push(a)});ta=!1;J=a.organizationId;S=a.deploymentId;T=a.buttonId;ja=a.agentId;ua=a.doFallback;Ea=a.sessionId;va=a.trackingId;Fa=a.chatKey;Ga=a.brandingImage;Ha=a.mobileBrandingImage;Ia=a.windowTitle;wa=a.transcriptSaveEnabled;ka=a.language;la=a.lastUrl;xa=a.oref;ya=
a.geoLocation;za=a.isPost;Aa=a.receiveQueueUpdates;C=a.prechatData;Z=a.localName;fa=a.name;P=a.heldSneakPeek;U=a.lastSneakPeek;Y=a.heldIsTyping;ha=a.lastIsTyping;O=a.sneakPeekTimeout;Ja=a.requestTime;Ka=a.acceptTime;I=a.postChatUrl;Q=a.queuePosition;Ba=a.customEvents;ia=a.contentServerUrl;contentEndpoint=a.contentEndpoint;A=a.detailsInfo;L=a.prechatEntities;M=a.isFileRequested;La=a.dispQueuePosition;da=a.clientType;R=a.isChatRequested;ga=a.isChatRequestSuccessful;oa=a.isChatRequestFailed;z=a.isChatEstablished;
F=a.isChatEnded;aa=a.isAgentTyping;V=a.isChatTransferredToQueue;ca=a.isChatTransferredToBot;ba=a.isChatTransferredToSbrSkill;W=a.isSneakPeekEnabled;ma=a.visitorInfo;x.init(a.idleTimeoutEnabled,a.idleTimeoutWarningInSeconds,a.idleTimeoutTimeoutInSeconds,a.idleTimeoutIsRunning);this.onMutate()},abortConnection:function(){l.connection.abortConnection()},startChat:function(a){da=a?a:"chasitor";R=!0;Ja=(new Date).getTime();l.connection.start(da);this.onMutate()},reinitializeSession:function(){l.connection.reinitializeSession()},
markPreviousRichMessageClicked:function(){var a=E[E.length-1];a&&"string"!==typeof a.getPublicInterface().getContent()&&(a.getPublicInterface().getContent().isOptionClicked=!0)},sendMessage:function(a){if(!z||F)throw Error("You cannot call sendMessage while not in an engaged chat!");6E3<a.length&&(a=a.substr(0,6E3));var b=[];na.forEach(function(c){var d=c.execute(a);d.isRuleTriggered&&(a=d.message,b.push(c))});U="";ha=!1;O&&(clearTimeout(O),O=null);if(0===a.length&&0<b.length)return x.stop(),y.sendSensitiveDataRuleTriggered(b);
this.markPreviousRichMessageClicked();var d=new v(v.TYPE.CHASITOR,a,Z);E.push(d);this.onMutate();q(r.CHASITOR_CHAT_MESSAGE,d.getPublicInterface());return y.sendMessage(a).complete(function(){0<b.length&&y.sendSensitiveDataRuleTriggered(b);x.stop()})},getRichAgentAvatar:function(){return Va},sendMenuClick:function(a){return function(){this.chasitorRichMessage(a.innerText,Z);var b=D.findAncestor(a,"operator");b.parentNode.removeChild(b);D.clickRichItemResponse(a,D.richResponse,y,x,"ChatWindowMenu")}.bind(this)},
sendFooterMenuClick:function(a){return function(){this.chasitorRichMessage(a.innerText,Z);document.getElementById("footerMenuContainer").style.display="none";D.clickRichItemResponse(a,D.richResponse,y,x,"ChatWindowFooterMenu")}.bind(this)},sendSnapInRichMessage:function(a){this.markPreviousRichMessageClicked();var b=new v(v.TYPE.CHASITOR,a.actions[0].value,this.getName());E.push(b);D.clickSnapInRichItemResponse(a,D.richResponse,y,x);this.onMutate();q(r.CHASITOR_CHAT_MESSAGE,b.getPublicInterface())},
toggleFooterMenuBinding:function(a){return D.toggleFooterMenu},hideFooterMenuBinding:function(){return D.hideFooterMenu},hideFooterMenu:D.hideFooterMenu,sendButtonClick:function(a){return function(){this.chasitorRichMessage(a.innerText,Z);if(document.getElementById("buttonWrapper")){var b=document.getElementById("buttonWrapper");b.parentNode.removeChild(b)}document.getElementById("chatTranscript")?(b=document.getElementById("chatTranscript"),Sfdc.Dom.removeClass(b,"transcript-pull-up")):document.getElementById("custom-chat-buttons")&&
(b=document.getElementById("custom-chat-buttons"),b.parentNode.removeChild(b));D.clickRichItemResponse(a,D.richResponse,y,x,"ChatWindowButton")}.bind(this)},moveButtons:function(a,b){return function(){D.moveButtons(a,b)}},sanitizeText:D.sanitizeText,sendSneakPeek:function(a){if(!z||F)throw Error("You cannot call sendSneakPeek while not in an engaged chat!");if(!W)throw Error("You cannot call sendSneakPeek when Sneak Peek is disabled!");P=a;O||(O=setTimeout(Ra,1E3));this.onMutate()},sendTypingUpdate:function(a){if(!z||
F)throw Error("You cannot call sendTypingUpdate while not in an engaged chat!");Y=a;O||(O=setTimeout(Ra,1E3));this.onMutate()},endChat:function(){function a(){I||(F=!0,l.connection.stop(),x.stop(),p(),D.clearRichElements(),q(r.CHASITOR_CHAT_ENDED,K.CHASITOR))}if(!(z||V||ba||ca)||F)throw Error("You cannot call endChat while not in an engaged chat!");ba=ca=V=!1;this.onMutate();return y.endChat().complete(a).error(a)},getCustomEvents:function(){return Ba.slice()},addCustomEventListener:function(a,b){window.liveagent.addEventListener("customEvent_"+
a,b)},cancelFileTransfer:function(){function a(){x.stop()}if(!M)throw Error("You cannot cancel file transfer");M=!1;this.onMutate();return y.cancelFileTransfer().complete(a).error(a)},cancelChat:function(){function a(){var a=new v(v.TYPE.SYSTEM.CANCELED_CHASITOR);E.push(a);l.connection.stop();q(r.CHASITOR_CHAT_CANCELED,a.getPublicInterface())}if(!R)throw Error("You cannot call cancelChat while not in an requested chat!");F=!0;this.onMutate();return y.cancelChat().complete(a).error(a)},restoreChasitorIdleTimeout:function(){x.restore()},
stopChasitorIdleTimeout:function(){x.stop()},setOrgId:function(a){J=a;this.onMutate()},setDeploymentId:function(a){S=a;this.onMutate()},setButtonId:function(a){T=a;this.onMutate()},addCustomDetail:function(a,b,d){if(R)throw Error("Custom details cannot be added after the chat has been requested!");"undefined"==typeof d&&(d=!0);a=new Pa(a,b,d);C.push(a);return a},setVisitorInfo:function(a,b,d){if(R)throw Error("Visitor info cannot be set after the chat has been requested!");ma={visitCount:a,originalReferrer:b,
pages:d};this.onMutate()},addAutoQuery:function(a,b,d,c){if(R)throw Error("Custom details cannot be added after the chat has been requested!");for(var e=0;e<C.length;e++)C[e].getPublicInterface().getLabel()==a&&C[e].addEntityMap(b,d,!1,!0,c)},addFastFill:function(a,b,d){if(R)throw Error("Custom details cannot be added after the chat has been requested!");for(var c=0;c<C.length;c++)C[c].getPublicInterface().getLabel()==a&&C[c].addEntityMap(b,d,!0,!1,!0)},addEntity:function(a,b,d,c,e){if(R)throw Error("Entities cannot be added after the chat has been requested!");
a=new Qa(a,b,d,c,e);L.push(a);return a},addEntityFieldsMap:function(a,b,d,c,e,f){if(R)throw Error("Entities cannot be added after the chat has been requested!");for(var h=0;h<L.length;h++)L[h].getPublicInterface().getEntityName()==a&&L[h].addEntityFieldsMaps(b,d,c,e,f)},addTranscriptFieldMap:function(a,b){if(R)throw Error("Custom details cannot be added after the chat has been requested!");for(var d=0;d<C.length;d++)C[d].getPublicInterface().getLabel()==a&&C[d].addTranscriptField(b)},setLocalName:function(a){Z=
a;this.onMutate()},setName:function(a){fa=a;this.onMutate()},setIsPost:function(a){za=a;this.onMutate()},setReceiveQueueUpdates:function(a){Aa=a;this.onMutate()},setBrandingImage:function(a){Ga=a;this.onMutate()},setMobileBrandingImage:function(a){Ha=a;this.onMutate()},setWindowTitle:function(a){Ia=a;this.onMutate()},setTranscriptSaveEnabled:function(a){wa=a;this.onMutate()},doKnowledgeSearch:function(){if(R)throw Error("Custom details cannot be added after the chat has been requested!");for(var a=
0;a<C.length;a++)C[a].getPublicInterface().getLabel()==label&&C[a].doKnowledgeSearch()},setDispQueuePosition:function(a){La=a;this.onMutate()},setClientType:function(a){da=a;this.onMutate()},onMutate:function(){},isChatRequestSuccessful:function(){return ga},isChatRequestFailed:function(){return oa},isChatEstablished:function(){return z},isChatEngaged:function(){return z&&!F},isChatTransferredToQueue:function(){return V},isChatTransferredToBot:function(){return ca},isChatTransferredToSbrSkill:function(){return ba},
isChatEnded:function(){return F},isAgentTyping:function(){return aa},isSneakPeekEnabled:function(){return W},isFileRequested:function(){return M},getContentEndpoint:function(){return ia},getConnectionSessionId:function(){return l.connection.getSessionId()},getOrgId:function(){return J},getDeploymentId:function(){return S},getButtonId:function(){return T},getChatKey:function(){return Fa},getBrandingImage:function(){return Ga},getMobileBrandingImage:function(){return Ha},getWindowTitle:function(){return Ia},
getTranscriptSaveEnabled:function(){return wa},getRequestTime:function(){return Ja},getAcceptTime:function(){return Ka},getPostChatUrl:function(){return I},getQueuePosition:function(){return Q},getChatMessages:function(){for(var a=[],b=0;b<E.length;b++)a.push(E[b].getPublicInterface());return a},getLanguage:function(){return ka},getLastUrl:function(){return la},getOref:function(){return xa},getGeoLocation:function(){return ya},getVisitorInfo:function(){return ma},saveChat:function(){Za()},sendCustomEvent:function(a,
b){if(!z||F)throw Error("You cannot call sendCustomEvent while not in an engaged chat!");if(b&&"string"!=typeof b)throw Error("Data must be a string");if("string"!=typeof a)throw Error("Type must be a string");if(b&&6E3<b.length)throw Error("Data cannot exceed 6000 characters");if(256<a.length)throw Error("Type cannot exceed 256 characters");return y.sendCustomEvent(a,b)},getDetails:function(){return A},getJsonEncodedDetails:function(){return H.jsonEncode(A)},getDispQueuePosition:function(){return La},
getClientType:function(){return da},getName:function(){return fa},chasitorRichMessage:function(a,b){var d=new v(v.TYPE.CHASITOR,a,b);E.push(d);q(r.CHASITOR_CHAT_MESSAGE,d.getPublicInterface())}}})();